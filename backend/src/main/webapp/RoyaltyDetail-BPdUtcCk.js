import{hi as H,hj as O,hz as W,r as i,hl as X,hI as Z,f as ee,hm as h,hn as te,ho as p,hp as r,hq as t,hx as _,hr as C,hR as F,hu as L,hs as g,ht as I,hJ as R,hK as T,hv as n,b as z,hy as N,hS as B,g3 as c}from"./index-CRrSqBSg.js";import{P as ae}from"./PageBackground2-CY7PUuwQ.js";import{g as se}from"./royalty-DqTHozkf.js";import{g as le,s as ne}from"./feedback-CsxdGIKI.js";import{f as oe,a as j,b as re}from"./Navbar-DqK1H5Mm.js";import{u as de}from"./notice-BXE7xEZR.js";import"./announcement-DV9cg1hu.js";const ue={class:"tab-container"},ie={class:"tab-header"},ce={class:"tab-content"},pe={class:"query-area"},fe=["min"],me={class:"fee-table"},ve={key:0},be=["onClick"],_e={class:"total-area"},ge={class:"total-amount"},ke={class:"pagination-area"},De=["disabled"],ye={class:"page-info"},he=["disabled"],Ce={class:"tab-content"},we={class:"feedback-table"},Ve={key:0},xe={class:"content-cell"},Ne={class:"reply-cell"},$e={__name:"RoyaltyDetail",setup(Me){O();const $=W();de();const f=i("fee"),m=i([]),v=i(!1),E=i({}),d=i({content:"",feedback_id:""}),a=X({startDate:"2026-01-01",endDate:"",taskName:"",page:1,size:10}),k=i([]),w=i(0),V=i(0),M=Z(()=>Math.ceil(w.value/a.size)),P=()=>{const s=new Date,e=s.getFullYear(),D=String(s.getMonth()+1).padStart(2,"0"),y=String(s.getDate()).padStart(2,"0");return`${e}-${D}-${y}`},A=s=>s?re(s).split(" ")[0]:"",x=async()=>{if(a.startDate&&a.endDate&&new Date(a.endDate)<new Date(a.startDate)){c.error("结束日期不能早于开始日期，请重新选择");return}try{const s={startDate:a.startDate,endDate:a.endDate,page:a.page,size:a.size},e=await se(s);if(e.res_code==="0000"){const{total:D,list:y}=e.data;w.value=D;let b=y.filter(o=>{const u=o.created_at?o.created_at.split(" ")[0]:"";return!a.startDate&&!a.endDate?!0:a.startDate&&!a.endDate?u>=a.startDate:(!a.startDate&&a.endDate||u>=a.startDate)&&u<=a.endDate});a.taskName&&(b=b.filter(o=>o.article_title?.toLowerCase().includes(a.taskName.toLowerCase()))),k.value=b,V.value=b.reduce((o,u)=>o+(Number(u.fee_amount)||0),0)}else alert(`查询失败：${e.res_msg}`),k.value=[],w.value=0,V.value=0}catch(s){console.error("查询稿费明细失败：",s),alert("网络异常，查询失败"),k.value=[],w.value=0,V.value=0}},J=()=>{a.startDate="2026-01-01";const s=P();a.endDate=s<"2026-01-01"?"2026-01-01":s,a.taskName="",a.page=1,x()},U=s=>{s<1||s>M.value||(a.page=s,x())},K=s=>{E.value=s,d.value={content:"",feedback_id:s.feedback_id},v.value=!0},Q=async()=>{if(!d.value.content.trim()){c.error("请填写反馈理由");return}if(!$.userInfo?.user_id){c.error("请先登录"),v.value=!1;return}const s={user_id:$.userInfo.user_id,content:d.value.content,feedback_id:d.value.feedback_id};try{const e=await ne(s);e.res_code==="0000"?(c.success("反馈提交成功！"),v.value=!1,d.value.content="",q()):c.error(`提交失败：${e.data?.res_msg||"未知错误"}`)}catch(e){c.error("网络异常，提交失败"),console.error("反馈提交失败:",e)}},Y=s=>({pending:"待处理",replied:"已回复",resolved:"已解决",rejected:"已驳回"})[s]||"未知状态",G=s=>({pending:"status-pending",replied:"status-replied",resolved:"status-resolved",rejected:"status-rejected"})[s]||"",q=async()=>{if($.userInfo?.user_id)try{const s=await le({page:1,size:10});s.res_code==="0000"?m.value=s.data.list||[]:(c.error(`获取反馈列表失败：${s.res_msg}`),m.value=[])}catch(s){c.error("网络异常，获取反馈列表失败"),console.error("获取反馈列表失败:",s),m.value=[]}};return ee(()=>{const s=P();a.endDate=s<a.startDate?a.startDate:s,x(),q()}),(s,e)=>{const D=h("el-input"),y=h("el-form-item"),b=h("el-form"),o=h("el-button"),u=h("el-dialog");return p(),te(ae,null,{"page-title":r(()=>[...e[10]||(e[10]=[N("我的稿费与反馈",-1)])]),"card-content":r(()=>[t("div",ue,[t("div",ie,[t("div",{class:F(["tab-item",{active:f.value==="fee"}]),onClick:e[0]||(e[0]=l=>f.value="fee")}," 我的稿费明细 ",2),t("div",{class:F(["tab-item",{active:f.value==="feedback"}]),onClick:e[1]||(e[1]=l=>f.value="feedback")}," 我的反馈记录 ",2)]),C(t("div",ce,[t("div",pe,[e[11]||(e[11]=t("label",null,"开始日期:",-1)),C(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=l=>a.startDate=l),class:"date-input",min:"2026-01-01"},null,512),[[L,a.startDate]]),e[12]||(e[12]=t("label",{class:"ml-20"},"结束日期:",-1)),C(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=l=>a.endDate=l),class:"date-input",min:a.startDate||"2026-01-01"},null,8,fe),[[L,a.endDate]]),e[13]||(e[13]=t("label",{class:"ml-20"},"任务名称:",-1)),C(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=l=>a.taskName=l),placeholder:"输入任务名称查询",class:"task-input"},null,512),[[L,a.taskName]]),t("button",{class:"query-btn",onClick:x},"查询"),t("button",{class:"reset-btn ml-20",onClick:J},"重置")]),t("table",me,[e[16]||(e[16]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"任务名称"),t("th",null,"部门"),t("th",null,"金额"),t("th",null,"操作")])],-1)),t("tbody",null,[k.value.length===0?(p(),g("tr",ve,[...e[14]||(e[14]=[t("td",{colspan:"6",class:"empty-tip"},"暂无稿费数据",-1)])])):I("",!0),(p(!0),g(R,null,T(k.value,(l,S)=>(p(),g("tr",{key:l.feedback_id||S},[t("td",null,n(l.statistical_month||"-"),1),t("td",null,n(l.article_title||"-"),1),t("td",null,n(z(oe)(l.department_id)),1),t("td",null,n(z(j)(l.fee_amount))+"元",1),t("td",null,[t("button",{class:"feedback-btn",onClick:Se=>K(l)},"反馈",8,be)])]))),128))]),t("template",_e,[e[15]||(e[15]=N(" 共计: ",-1)),t("span",ge,n(z(j)(V.value))+"元",1)])]),t("div",ke,[t("button",{class:"page-btn",onClick:e[5]||(e[5]=l=>U(a.page-1)),disabled:a.page<=1},"上一页",8,De),t("span",ye," 第"+n(a.page)+"页 / 共"+n(M.value)+"页 ",1),t("button",{class:"page-btn",onClick:e[6]||(e[6]=l=>U(a.page+1)),disabled:a.page>=M.value},"下一页",8,he)])],512),[[B,f.value==="fee"]]),C(t("div",Ce,[t("table",we,[e[18]||(e[18]=t("thead",null,[t("tr",null,[t("th",null,"稿费名称"),t("th",null,"反馈内容"),t("th",null,"提交时间"),t("th",null,"反馈状态"),t("th",null,"管理员回复")])],-1)),t("tbody",null,[!m.value||m.value.length===0?(p(),g("tr",Ve,[...e[17]||(e[17]=[t("td",{colspan:"6",class:"empty-tip"},"暂无反馈记录",-1)])])):I("",!0),(p(!0),g(R,null,T(m.value,(l,S)=>(p(),g("tr",{key:l.feedback_id||S},[t("td",null,n(l.feedback_id||"-"),1),t("td",xe,n(l.content||"-"),1),t("td",null,n(A(l.created_at)||"-"),1),t("td",null,[t("span",{class:F(["status-tag",G(l.status)])},n(Y(l.status)),3)]),t("td",Ne,n(l.reply_content||"暂无回复"),1)]))),128))])])],512),[[B,f.value==="feedback"]])]),_(u,{modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=l=>v.value=l),title:"提交稿费反馈",width:"400px",modal:!1,class:"no-shadow-dialog"},{footer:r(()=>[_(o,{onClick:e[8]||(e[8]=l=>v.value=!1)},{default:r(()=>[...e[19]||(e[19]=[N("取消",-1)])]),_:1}),_(o,{type:"primary",onClick:Q},{default:r(()=>[...e[20]||(e[20]=[N("提交",-1)])]),_:1})]),default:r(()=>[_(b,{model:d.value,"label-width":"80px"},{default:r(()=>[_(y,{label:"反馈理由",required:""},{default:r(()=>[_(D,{modelValue:d.value.content,"onUpdate:modelValue":e[7]||(e[7]=l=>d.value.content=l),type:"textarea",rows:4,placeholder:"请输入您的反馈问题（如稿费金额错误、漏算等）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),default:r(()=>[e[21]||(e[21]=t("div",{class:"title-line"},null,-1))]),_:1})}}},Re=H($e,[["__scopeId","data-v-0afd1b5d"]]);export{Re as default};

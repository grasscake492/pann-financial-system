import{hh as ue,r as c,hk as $,hH as J,f as de,hm as ce,hn as i,ho as pe,hp as e,hr as r,hs as v,hQ as L,hq as p,hS as M,ht as C,hI as F,hJ as S,hu as o,b as O,hx as y,hT as G,hU as ve,g2 as n,g3 as me,hV as _e}from"./index-C7oC9Sm-.js";import{P as be}from"./PageBackground2-CjL8nwIj.js";import{a as fe,d as ye,b as ke}from"./royalty-C6ccYjyY.js";import{a as ge,r as he,u as W}from"./feedback-DEOOQuX0.js";import{F as Ce,a as we}from"./feedbackStatus-DqnZOqTf.js";import"./Navbar-Cp1G5LLH.js";const Ue={class:"tab-buttons"},$e={key:0},Me={class:"query-form"},De={class:"task-table"},Ve={key:0},Le=["onClick"],Fe=["onClick"],Se={key:1},xe={class:"feedback-filter"},Te={class:"feedback-item-list"},qe={key:0,class:"empty-tip"},Ae={class:"feedback-header"},Be={class:"feedback-id"},Ee={class:"feedback-content"},Re={class:"feedback-actions"},Ie=["onClick"],Ne=["onClick"],Pe={key:0,class:"pagination"},ze=["disabled"],je=["disabled"],Ke={key:1,class:"dialog-mask"},Qe={class:"dialog-content"},Ye={key:2,class:"dialog-mask"},He={class:"dialog-content"},Je={key:2},Oe={class:"manage-form"},Ge={key:0,class:"selected-members"},We=["onClick"],Xe={class:"form-item"},Ze={class:"form-item"},et={class:"radio-group"},tt={class:"radio-item"},st={class:"radio-item"},lt={class:"form-item"},at={class:"form-item"},nt={class:"form-item"},ot=["disabled"],it={class:"modal-body"},rt={key:0,class:"user-list"},ut={class:"user-info"},dt=["onClick","disabled"],ct={key:1,class:"empty-tip"},pt={__name:"ManageCenter",setup(vt){const m=c("query"),x=async l=>{switch(m.value=l,l){case"query":await w();break;case"feedback":await V();break;case"manage":await H();break}},f=$({month:"",article_title:""}),T=c([]),w=async()=>{try{const l=new Date().getFullYear(),t={statistical_month:f.month?`${l}-${f.month.padStart(2,"0")}`:"",article_title:f.article_title},s=await fe(t);s.res_code==="0000"?T.value=s.data?.list||[]:n.error(`获取任务列表失败：${s.res_msg}`)}catch{n.error("网络异常，获取任务列表失败")}},X=(l={})=>{m.value="manage",a.article_title=l.article_title||"",a.article_type=l.article_type||"",a.fee_amount=l.fee_amount||"";const t=l.statistical_month||"2026-01";a.statistical_month=t<"2026-01"?"2026-01":t,a.department_id=l.department_id||"",l.user_id&&l.real_name&&l.student_number&&(d.value=Array.isArray(l.user_id)?l.user_id.map((s,u)=>({user_id:s,real_name:l.real_name[u],student_number:l.student_number[u]})):[{user_id:l.user_id,real_name:l.real_name,student_number:l.student_number}])},Z=async l=>{try{await me.confirm("确定要删除该任务吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await ye(l);t.res_code==="0000"?(n.success("删除成功"),await w()):n.error(`删除失败：${t.res_msg}`)}catch(t){t!=="cancel"&&n.error("网络异常，删除失败")}},D=c([]),_=c(1),q=c(2),k=c(""),g=c(""),A=$({page:1,size:100,status:""}),B=c(!1),b=c(""),h=$({reply_content:""}),E=c(!1),U=$({status:"pending"}),R=J(()=>{let l=[...D.value];if(k.value&&(l=l.filter(u=>u.created_at?.split("-")[1]===k.value.padStart(2,"0"))),g.value){const u=g.value.trim().toLowerCase();l=l.filter(j=>j.real_name?.toLowerCase().includes(u))}const t=(_.value-1)*q.value,s=t+q.value;return l.slice(t,s)}),I=J(()=>{let l=[...D.value];if(k.value&&(l=l.filter(t=>t.created_at?.split("-")[1]===k.value.padStart(2,"0"))),g.value){const t=g.value.trim().toLowerCase();l=l.filter(s=>s.real_name?.toLowerCase().includes(t))}return Math.ceil(l.length/q.value)||1}),V=async()=>{try{const l=await ge(A);l.res_code==="0000"?(D.value=l.data.list||[],_.value=1):n.error(`查询反馈失败：${l.res_msg}`)}catch{n.error("网络异常，查询反馈失败")}},ee=()=>{_.value=1},K=l=>{l<1||l>I.value||(_.value=l)},te=l=>{b.value=l,h.reply_content="",B.value=!0},Q=()=>{B.value=!1,b.value="",h.reply_content=""},se=async()=>{if(!h.reply_content.trim()){n.warning("请输入回复内容");return}try{const l=await he(b.value,{reply_content:h.reply_content});l.res_code==="0000"?(n.success("回复成功"),Q(),await W(b.value,{status:"replied"}),await V()):n.error(`回复失败：${l.res_msg}`)}catch{n.error("网络异常，回复失败")}},le=l=>{b.value=l;const t=D.value.find(s=>s.feedback_id===l);t&&(U.status=t.status||"pending"),E.value=!0},Y=()=>{E.value=!1,b.value="",U.status="pending"},ae=async()=>{try{const l=await W(b.value,{status:U.status});l.res_code==="0000"?(n.success("状态更新成功"),Y(),await V()):n.error(`状态更新失败：${l.res_msg}`)}catch{n.error("网络异常，状态更新失败")}},N=c(!1),P=c([]),d=c([]),a=$({article_title:"",article_type:"",fee_amount:"",statistical_month:"2026-01",department_id:""}),H=async()=>{try{const l=await _e({page:1,size:999});l.res_code==="0000"?P.value=l.data.list||[]:n.error(`加载用户列表失败：${l.res_msg}`)}catch{n.error("网络异常，加载用户列表失败")}},ne=async()=>{N.value=!0,await H()},z=()=>{N.value=!1},oe=l=>{if(d.value.some(t=>t.user_id===l.user_id)){n.warning(`已选择过${l.real_name}，请勿重复选择`);return}d.value.push({user_id:l.user_id,real_name:l.real_name,student_number:l.student_number}),n.success(`已选择 ${l.real_name}`)},ie=l=>{d.value.splice(l,1),n.success("已删除该成员")},re=async()=>{if(d.value.length===0){n.warning("请至少选择一名成员");return}if(!a.article_title){n.warning("请输入稿件标题");return}if(!a.article_type){n.warning("请选择稿件类型（校对/编辑）");return}if(!a.fee_amount||Number(a.fee_amount)<=0){n.warning("请输入有效的稿费金额（大于0）");return}if(!a.statistical_month){n.warning("请选择统计月份");return}if(a.statistical_month<"2026-01"){n.warning("统计月份不能早于2026年1月，请重新选择"),a.statistical_month="2026-01";return}if(!a.department_id){n.warning("请选择所属部门");return}const l={user_id:d.value.map(t=>t.user_id),real_names:d.value.map(t=>t.real_name),student_numbers:d.value.map(t=>t.student_number),article_title:a.article_title,article_type:a.article_type,fee_amount:Number(a.fee_amount),statistical_month:a.statistical_month,department_id:Number(a.department_id)};try{const t=await ke(l);t.res_code==="0000"?(n.success("添加稿费记录成功"),Object.keys(a).forEach(s=>{a[s]=s==="statistical_month"?"2026-01":""}),d.value=[],m.value="query",await w()):n.error(`添加失败：${t.res_msg}`)}catch(t){n.error("网络异常，添加失败"),console.error("添加稿费失败详情：",t)}};return de(async()=>{await w(),await V()}),(l,t)=>(i(),ce(be,null,{"card-content":pe(()=>[e("div",Ue,[e("button",{class:L(["tab-btn",{active:m.value==="query"}]),onClick:t[0]||(t[0]=s=>x("query"))}," 任务查询 ",2),e("button",{class:L(["tab-btn",{active:m.value==="feedback"}]),onClick:t[1]||(t[1]=s=>x("feedback"))}," 反馈处理 ",2),e("button",{class:L(["tab-btn",{active:m.value==="manage"}]),onClick:t[2]||(t[2]=s=>x("manage"))}," 任务管理 ",2)]),m.value==="query"?(i(),r("div",$e,[e("div",Me,[t[20]||(t[20]=e("label",null,"选择月份:",-1)),p(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=s=>f.month=s)},[...t[19]||(t[19]=[e("option",{value:""},"请选择",-1),e("option",{value:"01"},"1月",-1),e("option",{value:"02"},"2月",-1),e("option",{value:"03"},"3月",-1),e("option",{value:"04"},"4月",-1),e("option",{value:"05"},"5月",-1),e("option",{value:"06"},"6月",-1),e("option",{value:"07"},"7月",-1),e("option",{value:"08"},"8月",-1),e("option",{value:"09"},"9月",-1),e("option",{value:"10"},"10月",-1),e("option",{value:"11"},"11月",-1),e("option",{value:"12"},"12月",-1)])],512),[[M,f.month]]),t[21]||(t[21]=e("label",null,"任务名称:",-1)),p(e("input",{type:"text",placeholder:"输入任务名称查询",class:"form-input","onUpdate:modelValue":t[4]||(t[4]=s=>f.article_title=s)},null,512),[[C,f.article_title]]),e("button",{class:"query-btn",onClick:w},"查询")]),e("table",De,[t[23]||(t[23]=e("thead",null,[e("tr",null,[e("th",null,"日期"),e("th",null,"任务名称"),e("th",null,"参与人"),e("th",null,"金额详情"),e("th",null,"操作")])],-1)),e("tbody",null,[T.value.length===0?(i(),r("tr",Ve,[...t[22]||(t[22]=[e("td",{colspan:"4",class:"empty-tip"},"暂无任务记录",-1)])])):v("",!0),(i(!0),r(F,null,S(T.value,s=>(i(),r("tr",{key:s.record_id},[e("td",null,o(s.created_at),1),e("td",null,o(s.article_title||0),1),e("td",null,o(s.real_names?.join(", ")||"-"),1),e("td",null,o(s.fee_amount||0)+"元",1),e("td",null,[e("button",{class:"op-btn",onClick:u=>X(s)},"修改",8,Le),e("button",{class:"op-btn danger",onClick:u=>Z(s.record_id)},"删除",8,Fe)])]))),128))])])])):v("",!0),m.value==="feedback"?(i(),r("div",Se,[e("div",xe,[t[26]||(t[26]=e("label",null,"反馈状态:",-1)),p(e("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=s=>A.status=s)},[...t[24]||(t[24]=[e("option",{value:""},"全部",-1),e("option",{value:"pending"},"待处理",-1),e("option",{value:"replied"},"已回复",-1)])],512),[[M,A.status]]),t[27]||(t[27]=e("label",null,"月份:",-1)),p(e("select",{class:"form-select","onUpdate:modelValue":t[6]||(t[6]=s=>k.value=s)},[...t[25]||(t[25]=[e("option",{value:""},"全部",-1),e("option",{value:"1"},"1月",-1),e("option",{value:"2"},"2月",-1),e("option",{value:"3"},"3月",-1),e("option",{value:"4"},"4月",-1),e("option",{value:"5"},"5月",-1),e("option",{value:"6"},"6月",-1),e("option",{value:"7"},"7月",-1),e("option",{value:"8"},"8月",-1),e("option",{value:"9"},"9月",-1),e("option",{value:"10"},"10月",-1),e("option",{value:"11"},"11月",-1),e("option",{value:"12"},"12月",-1)])],512),[[M,k.value]]),t[28]||(t[28]=e("label",null,"用户姓名:",-1)),p(e("input",{type:"text",placeholder:"输入姓名模糊查询",class:"form-input","onUpdate:modelValue":t[7]||(t[7]=s=>g.value=s)},null,512),[[C,g.value]]),e("button",{class:"query-btn",onClick:ee},"查询")]),e("div",Te,[R.value.length===0?(i(),r("div",qe,"暂无反馈数据")):v("",!0),(i(!0),r(F,null,S(R.value,s=>(i(),r("div",{class:"feedback-item",key:s.feedback_id},[e("div",Ae,[e("span",Be,"反馈ID："+o(s.feedback_id),1),e("span",{class:L(["status-tag",O(Ce)[s.status]])},o(O(we)[s.status]),3)]),e("div",Ee,[e("p",null,[t[29]||(t[29]=e("span",{class:"label"},"反馈用户：",-1)),y(o(s.real_name),1)]),e("p",null,[t[30]||(t[30]=e("span",{class:"label"},"反馈内容：",-1)),y(o(s.content),1)]),e("p",null,[t[31]||(t[31]=e("span",{class:"label"},"反馈时间：",-1)),y(o(s.created_at),1)]),e("p",null,[t[32]||(t[32]=e("span",{class:"label"},"回复时间：",-1)),y(o(s.replied_at||"未回复"),1)]),e("p",null,[t[33]||(t[33]=e("span",{class:"label"},"回复内容：",-1)),y(o(s.reply_content||"暂无回复"),1)])]),e("div",Re,[e("button",{class:"op-btn reply-btn",onClick:u=>te(s.feedback_id)},"回复",8,Ie),e("button",{class:"op-btn status-btn",onClick:u=>le(s.feedback_id)},"改状态",8,Ne)])]))),128))]),R.value.length>0?(i(),r("div",Pe,[e("button",{class:"page-btn",onClick:t[8]||(t[8]=s=>K(_.value-1)),disabled:_.value<=1}," 上一页 ",8,ze),e("span",null,"第"+o(_.value)+"页 / 共"+o(I.value)+"页",1),e("button",{class:"page-btn",onClick:t[9]||(t[9]=s=>K(_.value+1)),disabled:_.value>=I.value}," 下一页 ",8,je)])):v("",!0),B.value?(i(),r("div",Ke,[e("div",Qe,[e("h4",null,"回复反馈（ID: "+o(b.value)+"）",1),p(e("textarea",{placeholder:"请输入回复内容",class:"reply-textarea","onUpdate:modelValue":t[10]||(t[10]=s=>h.reply_content=s)},null,512),[[C,h.reply_content]]),e("div",{class:"dialog-btns"},[e("button",{class:"cancel-btn",onClick:Q},"取消"),e("button",{class:"confirm-btn",onClick:se},"提交回复")])])])):v("",!0),E.value?(i(),r("div",Ye,[e("div",He,[e("h4",null,"更新反馈状态（ID: "+o(b.value)+"）",1),p(e("select",{class:"form-select","onUpdate:modelValue":t[11]||(t[11]=s=>U.status=s)},[...t[34]||(t[34]=[e("option",{value:"pending"},"待处理",-1),e("option",{value:"replied"},"已回复",-1)])],512),[[M,U.status]]),e("div",{class:"dialog-btns"},[e("button",{class:"cancel-btn",onClick:Y},"取消"),e("button",{class:"confirm-btn",onClick:ae},"确认更新")])])])):v("",!0)])):v("",!0),m.value==="manage"?(i(),r("div",Je,[t[45]||(t[45]=e("div",{class:"manage-title"},[e("div",{class:"title-line"}),e("h3",null,"添加稿费记录")],-1)),e("div",Oe,[e("div",{class:"form-item"},[e("button",{class:"select-member-btn",onClick:ne},"选择成员")]),d.value.length>0?(i(),r("div",Ge,[t[35]||(t[35]=e("h4",null,"已选成员：",-1)),(i(!0),r(F,null,S(d.value,(s,u)=>(i(),r("div",{class:"member-item",key:s.user_id},[e("span",null,"成员"+o(u+1)+"：姓名="+o(s.real_name)+"，学号="+o(s.student_number)+"，ID="+o(s.user_id),1),e("button",{class:"del-member-btn",onClick:j=>ie(u)},"删除",8,We)]))),128))])):v("",!0),e("div",Xe,[t[36]||(t[36]=e("label",null,"稿件标题:",-1)),p(e("input",{type:"text",placeholder:"输入稿件标题",class:"form-input","onUpdate:modelValue":t[12]||(t[12]=s=>a.article_title=s)},null,512),[[C,a.article_title]])]),e("div",Ze,[t[39]||(t[39]=e("label",null,"稿件类型:",-1)),e("div",et,[e("label",tt,[p(e("input",{type:"radio",name:"article_type","onUpdate:modelValue":t[13]||(t[13]=s=>a.article_type=s),value:"校对"},null,512),[[G,a.article_type]]),t[37]||(t[37]=y(" 校对 ",-1))]),e("label",st,[p(e("input",{type:"radio",name:"article_type","onUpdate:modelValue":t[14]||(t[14]=s=>a.article_type=s),value:"编辑"},null,512),[[G,a.article_type]]),t[38]||(t[38]=y(" 编辑 ",-1))])])]),e("div",lt,[t[40]||(t[40]=e("label",null,"稿费金额:",-1)),p(e("input",{type:"number",step:"1",min:"0",placeholder:"0.00",class:"form-input","onUpdate:modelValue":t[15]||(t[15]=s=>a.fee_amount=s)},null,512),[[C,a.fee_amount]])]),e("div",at,[t[41]||(t[41]=e("label",null,"统计月份:",-1)),p(e("input",{type:"month",class:"form-input","onUpdate:modelValue":t[16]||(t[16]=s=>a.statistical_month=s),min:"2026-01",max:"2035-12"},null,512),[[C,a.statistical_month]])]),e("div",nt,[t[43]||(t[43]=e("label",null,"所属部门:",-1)),p(e("select",{class:"form-select","onUpdate:modelValue":t[17]||(t[17]=s=>a.department_id=s)},[...t[42]||(t[42]=[e("option",{value:""},"请选择部门",-1),e("option",{value:"1"},"新闻部",-1),e("option",{value:"2"},"编辑部",-1),e("option",{value:"3"},"运营部",-1)])],512),[[M,a.department_id]])]),e("button",{class:"submit-btn",onClick:re,disabled:d.value.length===0},"提交添加",8,ot)]),N.value?(i(),r("div",{key:0,class:"modal-mask",onClick:z},[e("div",{class:"modal-content",onClick:t[18]||(t[18]=ve(()=>{},["stop"]))},[e("div",{class:"modal-header"},[t[44]||(t[44]=e("h3",null,"选择成员",-1)),e("button",{class:"close-modal",onClick:z},"×")]),e("div",it,[P.value.length>0?(i(),r("div",rt,[(i(!0),r(F,null,S(P.value,s=>(i(),r("div",{class:"user-item",key:s.user_id},[e("div",ut,[e("span",null,"姓名："+o(s.real_name),1),e("span",null,"学号："+o(s.student_number),1),e("span",null,"ID："+o(s.user_id),1)]),e("button",{class:"select-user-btn",onClick:u=>oe(s),disabled:d.value.some(u=>u.user_id===s.user_id)},o(d.value.some(u=>u.user_id===s.user_id)?"已选择":"选择"),9,dt)]))),128))])):(i(),r("div",ct,"暂无用户数据"))]),e("div",{class:"modal-footer"},[e("button",{class:"user-modal-confirm-btn",onClick:z},"确认选择")])])])):v("",!0)])):v("",!0)]),_:1}))}},gt=ue(pt,[["__scopeId","data-v-d86c935e"]]);export{gt as default};

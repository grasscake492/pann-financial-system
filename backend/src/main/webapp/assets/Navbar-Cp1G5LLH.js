import{hZ as S,hh as $,hi as k,hj as C,hy as N,hH as f,w as R,f as U,hr as p,hn as _,hp as u,hs as w,hQ as c,n as g,hK as D}from"./index-C7oC9Sm-.js";const M=(o={})=>{const m=`${Object.keys(o).sort().map(a=>`${a}=${o[a]}`).join("&")}your_backend_secret`;return S(m)},P=o=>{if(!o)return"";const s=new Date(o),i=s.getFullYear(),e=String(s.getMonth()+1).padStart(2,"0"),m=String(s.getDate()).padStart(2,"0"),a=String(s.getHours()).padStart(2,"0"),d=String(s.getMinutes()).padStart(2,"0");return`${i}-${e}-${m} ${a}:${d}`},K=o=>{if(!o&&o!==0)return"0.00";const s=Number(o);return isNaN(s)?"0.00":s.toFixed(2)},T=o=>({1:"新闻部",2:"编辑部",3:"运营部"})[o]||"未知部门",b={class:"navbar"},x={class:"nav-menu"},E={__name:"Navbar",setup(o){const s=k(),i=C(),e=N(),m=f(()=>{const n=e.userInfo.is_super_admin===!0,t=!!e.userInfo.admin_id&&!!e.userInfo.department_id;return n||t}),a={2:"EditorCenter",1:"NewsCenter",3:"OperationCenter"},d=f(()=>{if(!e.userInfo)return!1;let n="";return e.userInfo.is_super_admin?n="SystemManage":e.userInfo.admin_id&&e.userInfo.department_id&&(n=a[e.userInfo.department_id]||""),i.name===n}),I=f(()=>{const t=e.userInfo.is_super_admin||!!e.userInfo.admin_id?"AdminAnnouncement":"UserAnnouncement";return i.name===t}),l=n=>{s.push({name:n})},v=()=>{let n="";e.userInfo.is_super_admin?n="SystemManage":e.userInfo.admin_id&&e.userInfo.department_id&&(n=a[e.userInfo.department_id]||""),n?s.getRoutes().some(r=>r.name===n)?s.push({name:n}):alert(`暂无【${e.userInfo.department_name}】对应的管理页面！`):(alert("暂无管理页面权限！"),s.push({name:"Home"}))},h=()=>{console.log("当前用户:",{is_super_admin:e.userInfo.is_super_admin,admin_id:e.userInfo.admin_id,dept_id:e.userInfo.department_id});const n=e.userInfo.is_super_admin||!!e.userInfo.admin_id;console.log("是否是管理员:",n);const t=n?"AdminAnnouncement":"UserAnnouncement";console.log("目标路由:",t),s.getRoutes().some(A=>A.name===t)?s.push({name:t}):(alert(`路由未注册：${t}，请检查路由表！`),s.push({name:"Home"}))};R([()=>i.name,()=>e.userInfo],()=>{g(()=>{})},{immediate:!0,deep:!0});const y=async()=>{await g();try{if(e.userInfo&&e.userInfo.token&&e.userInfo.real_name){console.log("已有完整用户信息，无需重复拉取，避免覆盖");return}const n=M({timestamp:Date.now()}),t=D(),r=await e.loadUserProfile({token:t,sign:n});if(r&&r.res_code==="0000")console.log("拉取用户信息成功，数据有效");else{console.log("接口返回失败/数据无效，不覆盖原有用户信息");return}console.log("【拉取用户信息后】",e.userInfo)}catch(n){console.error("拉取用户信息失败：",n)}};return U(()=>{if(!e.userInfo.token){s.push({path:"/login"});return}y()}),(n,t)=>(_(),p("div",b,[t[3]||(t[3]=u("div",{class:"system-title"},"PANN财务管理系统",-1)),u("div",x,[u("span",{class:c(["nav-item",{active:n.$route.name==="Home"}]),onClick:t[0]||(t[0]=r=>l("Home"))}," 首页 ",2),u("span",{class:c(["nav-item",{active:n.$route.name==="UserRoyaltyDetail"}]),onClick:t[1]||(t[1]=r=>l("UserRoyaltyDetail"))}," 稿费明细 ",2),u("span",{class:c(["nav-item",{active:n.$route.name==="UserAccount"}]),onClick:t[2]||(t[2]=r=>l("UserAccount"))}," 账户页面 ",2),m.value?(_(),p("span",{key:0,class:c(["nav-item",{active:d.value}]),onClick:v},"管理中心 ",2)):w("",!0),u("span",{class:c(["nav-item",{active:I.value}]),onClick:h}," 公告 ",2)])]))}},j=$(E,[["__scopeId","data-v-84ffe06d"]]);export{j as N,K as a,P as b,T as f,M as g};

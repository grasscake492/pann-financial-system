import{hh as E,hi as N,hj as S,hk as h,r as g,hl as $,hm as I,hn as _,ho as v,hp as r,hq as b,hr as k,hs as w,ht as L,hu as m,hv as T,hw as V,hx as A,g2 as l,hy as U,hz as y,hA as j,hB as q,hC as D}from"./index-C7oC9Sm-.js";import{P as F}from"./PageBackground-YvUIJ2ow.js";import{m as M,v as O}from"./md5-BeoFLYFJ.js";import{u as z}from"./auth-C9jdv531.js";const Y={class:"login-container"},G={class:"form-group"},H={key:0,class:"error-tip"},J={class:"form-group",style:{position:"relative"}},K=["type"],Q={key:0,class:"error-tip"},W={class:"register-link"},X=["disabled"],Z={__name:"Login",setup(ee){const x=N(),B=S(),s=h({student_number:"",password:""}),t=h({student_number:"",password:""}),d=g(!1),i=g(!1),f=o=>{if(o==="student_number"){const e=s.student_number?.trim()||"";e?/^\d{12}$/.test(e)?t.student_number="":t.student_number="å­¦å·å¿…é¡»ä¸º12ä½çº¯æ•°å­—":t.student_number="å­¦å·ä¸èƒ½ä¸ºç©º"}else o==="password"&&!s.password?t.password="å¯†ç ä¸èƒ½ä¸ºç©º":t[o]=""},P=()=>{const o=O(s);return Object.assign(t,o),Object.keys(o).length===0},C=async()=>{if(P()){i.value=!0;try{const e=`${s.student_number}${s.password}default_secret`,p={student_number:s.student_number,password:s.password,sign:M(e)},n=await z(p);if(console.log("åå°è¿”å›çš„å®Œæ•´ç™»å½•æ•°æ®ï¼š",n),!n){l.error("ç™»å½•å¤±è´¥ï¼šæ— å“åº”æ•°æ®"),i.value=!1;return}const u=n.data&&n.data[0]||{};switch(n.res_code){case"0000":const c=U();if(c.userInfo={...c.userInfo,...u,department_name:u.department_name||"",isLogin:!!u.token},u.token)console.log("è¦å­˜çš„tokenï¼š",u.token),y(u.token),console.log("å­˜å®Œåæœ¬åœ°çš„tokenï¼š",j());else{l.error("ç™»å½•å¤±è´¥ï¼šæœªè·å–åˆ°ç”¨æˆ·ä»¤ç‰Œ"),i.value=!1;return}y(u.token),q(c.userRole),D(c.userInfo),l.success("ç™»å½•æˆåŠŸï¼");const R=B.query.redirect||"/home";await x.push(R);break;case"0004":l.error(n.res_msg||"å­¦å·æˆ–å¯†ç é”™è¯¯");break;case"0003":l.error(n.res_msg||"æƒé™ä¸è¶³ï¼Œæ— æ³•ç™»å½•");break;default:l.error(n.res_msg||"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•")}}catch(o){console.error("ç™»å½•è¯·æ±‚å¼‚å¸¸ï¼š",o),l.error("ç½‘ç»œå¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥")}finally{i.value=!1}}};return(o,e)=>{const p=$("router-link");return _(),I(F,null,{default:v(()=>[r("div",Y,[e[6]||(e[6]=r("h1",{class:"system-title"},"PANNè´¢åŠ¡ç®¡ç†ç³»ç»Ÿ",-1)),r("div",G,[b(r("input",{type:"text",placeholder:"å­¦å·",class:"input-field","onUpdate:modelValue":e[0]||(e[0]=a=>s.student_number=a),onBlur:e[1]||(e[1]=a=>f("student_number"))},null,544),[[L,s.student_number]]),t.student_number?(_(),k("div",H,m(t.student_number),1)):w("",!0)]),r("div",J,[b(r("input",{type:d.value?"text":"password",placeholder:"å¯†ç ",class:"input-field","onUpdate:modelValue":e[2]||(e[2]=a=>s.password=a),onBlur:e[3]||(e[3]=a=>f("password")),style:{"padding-right":"30px"}},null,40,K),[[T,s.password]]),r("span",{onClick:e[4]||(e[4]=a=>d.value=!d.value),style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",cursor:"pointer",color:"#999","user-select":"none"}},m(d.value?"ğŸ‘":"ğŸ‘€"),1),t.password?(_(),k("div",Q,m(t.password),1)):w("",!0)]),r("div",W,[V(p,{to:"/register"},{default:v(()=>[...e[5]||(e[5]=[A("æ²¡æœ‰è´¦å·ï¼Œæ³¨å†Œ",-1)])]),_:1})]),r("button",{class:"login-btn",onClick:C,disabled:i.value},m(i.value?"ç™»å½•ä¸­...":"ç™»å½•"),9,X)])]),_:1})}}},ne=E(Z,[["__scopeId","data-v-910a2943"]]);export{ne as default};

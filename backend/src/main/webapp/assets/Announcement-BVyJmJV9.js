import{hh as $,hy as V,r as d,hH as L,f as N,g2 as o,hm as U,hn as l,ho as w,hr as i,hp as s,hs as f,b as T,hI as q,hJ as z,hu as m,hU as y,hq as A,ht as C,hx as F}from"./index-C7oC9Sm-.js";import{A as H}from"./AnnounceBackground-C2NkGr6G.js";import{d as J,u as j,p as G}from"./announcement-DemJwFUU.js";import{g as K}from"./Navbar-Cp1G5LLH.js";import{u as O}from"./notice-Dn4Wf4C9.js";import"./feedback-DEOOQuX0.js";const P={key:0,class:"loading-tip"},Q={key:1,class:"announcement-list"},R={key:0,class:"empty-tip"},W=["onClick"],X={class:"item-content"},Y={class:"item-date"},Z={class:"item-title"},ee={key:0,class:"item-body"},te={key:1,class:"item-actions"},ne=["onClick"],se=["onClick"],oe={class:"add-btn-wrapper"},re={key:2,class:"modal-mask"},ae={class:"modal-content"},le={class:"modal-title"},ie={class:"form-item"},ce={class:"form-item"},ue={class:"modal-btns"},de={__name:"Announcement",setup(me){const _=V(),b=O();console.log("ç®¡ç†å‘˜");const c=d({}),g=L(()=>[...b.announcementList].sort((t,e)=>{const n=t.published_at||"";return(e.published_at||"").localeCompare(n)})),v=d(!1),u=d(!1),p=d(""),a=d({title:"",content:"",publisher_id:_.userInfo.user_id||""});N(async()=>{await h()});const h=async()=>{try{await b.fetchAllAnnouncements({page:1,size:50,sign:K({timestamp:Date.now()})})}catch(t){console.error("èŽ·å–å…¬å‘Šåˆ—è¡¨å¤±è´¥ï¼š",t),o.error("èŽ·å–å…¬å‘Šåˆ—è¡¨å¤±è´¥ï¼Œè¯·é‡è¯•")}},x=t=>t?`[${t.split(" ")[0]}]`:"æœªçŸ¥æ—¶é—´",D=t=>{console.log("âœ… ç‚¹å‡»äº†å…¬å‘Šï¼ŒIDï¼š",t),c.value[t]=!c.value[t],console.log("ðŸ“Œ å±•å¼€çŠ¶æ€ï¼š",c.value[t]);const e=g.value.find(n=>n.announcement_id===t);console.log("ðŸ“Œ sortedåˆ—è¡¨åŒ¹é…ç»“æžœï¼š",e?.announcement_id)},B=()=>{u.value=!1,a.value={title:"",content:"",publisher_id:_.userInfo.user_id||""},v.value=!0},E=async()=>{const{title:t,content:e,publisher_id:n}=a.value;if(!t.trim())return o.warning("è¯·è¾“å…¥å…¬å‘Šæ ‡é¢˜");if(!e.trim())return o.warning("è¯·è¾“å…¥å…¬å‘Šæ­£æ–‡");if(!n)return o.warning("å‘å¸ƒè€…IDä¸èƒ½ä¸ºç©ºï¼Œè¯·å…ˆç™»å½•");try{const r=await G({title:t.trim(),content:e.trim(),publisher_id:n});r.res_code==="0000"?(o.success("å…¬å‘Šå‘å¸ƒæˆåŠŸ"),await h(),k()):o.error(r.res_msg||"å‘å¸ƒå…¬å‘Šå¤±è´¥")}catch(r){console.error("å‘å¸ƒå…¬å‘Šå¤±è´¥ï¼š",r),o.error("å‘å¸ƒå…¬å‘Šå¤±è´¥ï¼Œè¯·é‡è¯•")}},I=t=>{u.value=!0,p.value=t.announcement_id,a.value={title:t.title,content:t.content,publisher_id:_.userInfo.user_id||""},v.value=!0},M=async()=>{const{title:t,content:e,publisher_id:n}=a.value;if(!t.trim()||!e.trim())return o.warning("æ ‡é¢˜å’Œæ­£æ–‡ä¸èƒ½ä¸ºç©º");if(!p.value)return o.warning("æœªé€‰æ‹©è¦ç¼–è¾‘çš„å…¬å‘Š");try{const r=await j(p.value,{title:t.trim(),content:e.trim(),publisher_id:n});r.res_code==="0000"?(o.success("å…¬å‘Šä¿®æ”¹æˆåŠŸ"),await h(),k()):o.error(r.res_msg||"ä¿®æ”¹å…¬å‘Šå¤±è´¥")}catch(r){console.error("ä¿®æ”¹å…¬å‘Šå¤±è´¥ï¼š",r),o.error("ä¿®æ”¹å…¬å‘Šå¤±è´¥ï¼Œè¯·é‡è¯•")}},S=async t=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡å…¬å‘Šå—ï¼Ÿ"))try{const e=await J(t);e.res_code==="0000"?(o.success("å…¬å‘Šåˆ é™¤æˆåŠŸ"),await h()):o.error(e.res_msg||"åˆ é™¤å…¬å‘Šå¤±è´¥")}catch(e){console.error("åˆ é™¤å…¬å‘Šå¤±è´¥ï¼š",e),o.error("åˆ é™¤å…¬å‘Šå¤±è´¥ï¼Œè¯·é‡è¯•")}},k=()=>{v.value=!1,a.value={title:"",content:"",publisher_id:_.userInfo.user_id||""},p.value=""};return(t,e)=>(l(),U(H,null,{"page-title":w(()=>[...e[4]||(e[4]=[F("æ‰€æœ‰å…¬å‘Š",-1)])]),"card-content":w(()=>[T(b).loading?(l(),i("div",P,"åŠ è½½ä¸­...")):(l(),i("div",Q,[g.value.length===0?(l(),i("div",R,"æš‚æ— å…¬å‘Š")):f("",!0),(l(!0),i(q,null,z(g.value,n=>(l(),i("div",{class:"announcement-item",key:n.announcement_id,onClick:r=>D(n.announcement_id)},[e[5]||(e[5]=s("div",{class:"item-line"},null,-1)),s("div",X,[s("div",Y,m(x(n.published_at)),1),s("div",Z,m(n.title),1),c.value[n.announcement_id]?(l(),i("div",ee,m(n.content),1)):f("",!0),c.value[n.announcement_id]?(l(),i("div",te,[s("button",{class:"edit-btn",onClick:y(r=>I(n),["stop"])},"ç¼–è¾‘",8,ne),s("button",{class:"delete-btn",onClick:y(r=>S(n.announcement_id),["stop"])},"åˆ é™¤",8,se)])):f("",!0)])],8,W))),128))])),s("div",oe,[s("button",{class:"add-announcement-btn",onClick:e[0]||(e[0]=n=>B())}," æ·»åŠ å…¬å‘Š ")]),v.value?(l(),i("div",re,[s("div",ae,[s("div",le,m(u.value?"ç¼–è¾‘å…¬å‘Š":"æ–°å¢žå…¬å‘Š"),1),s("div",ie,[e[6]||(e[6]=s("label",null,"æ ‡é¢˜ï¼š",-1)),A(s("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.title=n),class:"input-control",placeholder:"è¯·è¾“å…¥å…¬å‘Šæ ‡é¢˜"},null,512),[[C,a.value.title]])]),s("div",ce,[e[7]||(e[7]=s("label",null,"æ­£æ–‡ï¼š",-1)),A(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.content=n),class:"textarea-control",placeholder:"è¯·è¾“å…¥å…¬å‘Šæ­£æ–‡",rows:"6"},null,512),[[C,a.value.content]])]),s("div",ue,[s("button",{class:"btn cancel-btn",onClick:k},"å–æ¶ˆ"),s("button",{class:"btn confirm-btn",onClick:e[3]||(e[3]=n=>u.value?M():E())},m(u.value?"ç¡®å®šç¼–è¾‘":"ç¡®å®šæ·»åŠ "),1)])])])):f("",!0)]),_:1}))}},ge=$(de,[["__scopeId","data-v-ca0c6dbf"]]);export{ge as default};

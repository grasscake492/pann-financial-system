<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.dao.AdminMapper">

    <!-- 管理员表结果映射 -->
    <resultMap id="AdminResultMap" type="org.entity.Admin">
        <id property="adminId" column="admin_id" />
        <result property="userId" column="user_id" />
        <result property="studentNumber" column="student_number" />
        <result property="realName" column="real_name" />
        <result property="password" column="password" />
        <result property="email" column="email" />
        <result property="departmentId" column="department_id" />
        <result property="isSuperAdmin" column="is_super_admin" />
    </resultMap>

    <!-- 根据管理员ID查询 -->
    <select id="selectByAdminId" parameterType="java.lang.Long" resultMap="AdminResultMap">
        SELECT admin_id, user_id, student_number, real_name, password, email, department_id, is_super_admin
        FROM admins WHERE admin_id = #{adminId}
    </select>

    <!-- 根据用户ID查询管理员 -->
    <select id="selectByUserId" parameterType="java.lang.Long" resultMap="AdminResultMap">
        SELECT admin_id, user_id, student_number, real_name, password, email, department_id, is_super_admin
        FROM admins WHERE user_id = #{userId}
    </select>

    <!-- 根据学号查询管理员 -->
    <select id="selectByStudentNumber" parameterType="java.lang.String" resultMap="AdminResultMap">
        SELECT admin_id, user_id, student_number, real_name, password, email, department_id, is_super_admin
        FROM admins WHERE student_number = #{studentNumber}
    </select>

    <!-- 查询所有管理员 -->
    <select id="selectAllAdmins" resultMap="AdminResultMap">
        SELECT admin_id, user_id, student_number, real_name, password, email, department_id, is_super_admin
        FROM admins ORDER BY admin_id
    </select>

    <!-- 根据部门ID查询管理员 -->
    <select id="selectByDepartmentId" parameterType="java.lang.Long" resultMap="AdminResultMap">
        SELECT admin_id, user_id, student_number, real_name, password, email, department_id, is_super_admin
        FROM admins WHERE department_id = #{departmentId} ORDER BY admin_id
    </select>

    <!-- 查询最高级管理员 -->
    <select id="selectSuperAdmins" resultMap="AdminResultMap">
        SELECT admin_id, user_id, student_number, real_name, password, email, department_id, is_super_admin
        FROM admins WHERE is_super_admin = true ORDER BY admin_id
    </select>

    <!-- 统计管理员数量 -->
    <select id="countAdmins" resultType="int">
        SELECT COUNT(*) FROM admins
    </select>

    <!-- 插入管理员 -->
    <insert id="insertAdmin" parameterType="org.pannfmis.entity.Admin" useGeneratedKeys="true" keyProperty="adminId">
        INSERT INTO admins (user_id, student_number, real_name, password, email, department_id, is_super_admin)
        VALUES (#{userId}, #{studentNumber}, #{realName}, #{password}, #{email}, #{departmentId}, #{isSuperAdmin})
    </insert>

    <!-- 更新管理员 -->
    <update id="updateAdmin" parameterType="org.pannfmis.entity.Admin">
        UPDATE admins SET
                          user_id = #{userId},
                          student_number = #{studentNumber},
                          real_name = #{realName},
                          password = #{password},
                          email = #{email},
                          department_id = #{departmentId},
                          is_super_admin = #{isSuperAdmin}
        WHERE admin_id = #{adminId}
    </update>

    <!-- 更新管理员角色 -->
    <update id="updateAdminRole">
        UPDATE admins SET department_id = #{departmentId}, is_super_admin = #{isSuperAdmin}
        WHERE admin_id = #{adminId}
    </update>

    <!-- 删除管理员 -->
    <delete id="deleteByAdminId" parameterType="java.lang.Long">
        DELETE FROM admins WHERE admin_id = #{adminId}
    </delete>

</mapper>
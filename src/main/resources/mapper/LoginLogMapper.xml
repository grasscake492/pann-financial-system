<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.dao.LoginLogMapper">

    <!-- 登录日志表结果映射 -->
    <resultMap id="LoginLogResultMap" type="org.entity.LoginLog">
        <id property="logId" column="log_id" />
        <result property="userId" column="user_id" />
        <result property="ipAddress" column="ip_address" />
        <result property="loginAt" column="login_at" />
        <result property="status" column="status" />
    </resultMap>

    <!-- 根据日志ID查询 -->
    <select id="selectByLogId" parameterType="java.lang.Long" resultMap="LoginLogResultMap">
        SELECT log_id, user_id, ip_address, login_at, status FROM login_logs WHERE log_id = #{logId}
    </select>

    <!-- 根据用户ID查询登录日志 -->
    <select id="selectByUserId" parameterType="java.lang.Long" resultMap="LoginLogResultMap">
        SELECT log_id, user_id, ip_address, login_at, status
        FROM login_logs WHERE user_id = #{userId} ORDER BY log_id
    </select>

    <!-- 查询所有登录日志 -->
    <select id="selectAllLoginLogs" resultMap="LoginLogResultMap">
        SELECT log_id, user_id, ip_address, login_at, status FROM login_logs ORDER BY log_id
    </select>

    <!-- 查询最近登录日志 -->
    <select id="selectRecentLogs" resultMap="LoginLogResultMap">
        SELECT log_id, user_id, ip_address, login_at, status
        FROM login_logs ORDER BY login_at DESC LIMIT #{limit}
    </select>

    <!-- 分页查询登录日志 -->
    <select id="selectByPage" resultMap="LoginLogResultMap">
        SELECT log_id, user_id, ip_address, login_at, status
        FROM login_logs ORDER BY log_id LIMIT #{offset}, #{limit}
    </select>

    <!-- 统计登录日志数量 -->
    <select id="countLoginLogs" resultType="int">
        SELECT COUNT(*) FROM login_logs
    </select>

    <!-- 插入登录日志 -->
    <insert id="insertLoginLog" parameterType="org.pannfmis.entity.LoginLog" useGeneratedKeys="true" keyProperty="logId">
        INSERT INTO login_logs (user_id, ip_address, login_at, status)
        VALUES (#{userId}, #{ipAddress}, NOW(), #{status})
    </insert>

    <!-- 删除登录日志 -->
    <delete id="deleteByLogId" parameterType="java.lang.Long">
        DELETE FROM login_logs WHERE log_id = #{logId}
    </delete>

    <!-- 根据用户ID删除登录日志 -->
    <delete id="deleteByUserId" parameterType="java.lang.Long">
        DELETE FROM login_logs WHERE user_id = #{userId}
    </delete>

    <!-- 清理过期登录日志 -->
    <delete id="cleanExpiredLogs">
        DELETE FROM login_logs WHERE login_at &lt; DATE_SUB(NOW(), INTERVAL #{days} DAY)
    </delete>

</mapper>
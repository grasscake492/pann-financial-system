<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.dao.AnnouncementMapper">

    <!-- 公告表结果映射 -->
    <resultMap id="AnnouncementResultMap" type="org.entity.Announcement">
        <id property="announcementId" column="announcement_id" />
        <result property="title" column="title" />
        <result property="content" column="content" />
        <result property="publisherId" column="publisher_id" />
        <result property="publishedAt" column="published_at" />
        <result property="createdAt" column="created_at" />
        <result property="updatedAt" column="updated_at" />
    </resultMap>

    <!-- 根据公告ID查询 -->
    <select id="selectByAnnouncementId" parameterType="java.lang.Long" resultMap="AnnouncementResultMap">
        SELECT announcement_id, title, content, publisher_id, published_at, created_at, updated_at
        FROM announcements WHERE announcement_id = #{announcementId}
    </select>

    <!-- 查询所有公告 -->
    <select id="selectAllAnnouncements" resultMap="AnnouncementResultMap">
        SELECT announcement_id, title, content, publisher_id, published_at, created_at, updated_at
        FROM announcements ORDER BY announcement_id
    </select>

    <!-- 查询最新公告 -->
    <select id="selectLatestAnnouncements" resultMap="AnnouncementResultMap">
        SELECT announcement_id, title, content, publisher_id, published_at, created_at, updated_at
        FROM announcements ORDER BY published_at DESC LIMIT #{limit}
    </select>

    <!-- 根据发布者ID查询公告 -->
    <select id="selectByPublisherId" parameterType="java.lang.Long" resultMap="AnnouncementResultMap">
        SELECT announcement_id, title, content, publisher_id, published_at, created_at, updated_at
        FROM announcements WHERE publisher_id = #{publisherId} ORDER BY announcement_id
    </select>

    <!-- 分页查询公告 -->
    <select id="selectByPage" resultMap="AnnouncementResultMap">
        SELECT announcement_id, title, content, publisher_id, published_at, created_at, updated_at
        FROM announcements ORDER BY announcement_id LIMIT #{offset}, #{limit}
    </select>

    <!-- 统计公告数量 -->
    <select id="countAnnouncements" resultType="int">
        SELECT COUNT(*) FROM announcements
    </select>

    <!-- 插入公告 -->
    <insert id="insertAnnouncement" parameterType="org.pannfmis.entity.Announcement" useGeneratedKeys="true" keyProperty="announcementId">
        INSERT INTO announcements (title, content, publisher_id, published_at, created_at, updated_at)
        VALUES (#{title}, #{content}, #{publisherId}, NOW(), NOW(), NOW())
    </insert>

    <!-- 更新公告 -->
    <update id="updateAnnouncement" parameterType="org.pannfmis.entity.Announcement">
        UPDATE announcements SET
                                 title = #{title},
                                 content = #{content},
                                 publisher_id = #{publisherId},
                                 published_at = #{publishedAt},
                                 updated_at = NOW()
        WHERE announcement_id = #{announcementId}
    </update>

    <!-- 删除公告 -->
    <delete id="deleteByAnnouncementId" parameterType="java.lang.Long">
        DELETE FROM announcements WHERE announcement_id = #{announcementId}
    </delete>

</mapper>
import{aB as C,aC as E,t as g,e as v,r as N,b as V,o as _,M as b,G as r,O as k,F as w,P as h,an as $,S as m,aD as I,V as L,R as T}from"./vue-Bt10MVH5.js";import{P as D}from"./PageBackground-B-fVelI8.js";import{h5 as F,fS as l,h6 as M,h7 as y,h8 as U,h9 as A,ha as O}from"./index-BWnjimtD.js";import{m as j,v as q}from"./md5-DZk-BtrE.js";import{u as G}from"./auth-x_l3GMB4.js";import"./crypto-DOZa04kq.js";const Y={class:"login-container"},z={class:"form-group"},H={key:0,class:"error-tip"},J={class:"form-group",style:{position:"relative"}},K=["type"],Q={key:0,class:"error-tip"},W={class:"register-link"},X=["disabled"],Z={__name:"Login",setup(ee){const x=C(),P=E(),s=g({student_number:"",password:""}),t=g({student_number:"",password:""}),d=v(!1),i=v(!1),f=o=>{if(o==="student_number"){const e=s.student_number?.trim()||"";e?/^\d{12}$/.test(e)?t.student_number="":t.student_number="å­¦å·å¿…é¡»ä¸º12ä½çº¯æ•°å­—":t.student_number="å­¦å·ä¸èƒ½ä¸ºç©º"}else o==="password"&&!s.password?t.password="å¯†ç ä¸èƒ½ä¸ºç©º":t[o]=""},B=()=>{const o=q(s);return Object.assign(t,o),Object.keys(o).length===0},R=async()=>{if(B()){i.value=!0;try{const e=`${s.student_number}${s.password}default_secret`,p={student_number:s.student_number,password:s.password,sign:j(e)},n=await G(p);if(console.log("åå°è¿”å›çš„å®Œæ•´ç™»å½•æ•°æ®ï¼š",n),!n){l.error("ç™»å½•å¤±è´¥ï¼šæ— å“åº”æ•°æ®"),i.value=!1;return}const u=n.data&&n.data[0]||{};switch(n.res_code){case"0000":const c=M();if(c.userInfo={...c.userInfo,...u,department_name:u.department_name||"",isLogin:!!u.token},u.token)console.log("è¦å­˜çš„tokenï¼š",u.token),y(u.token),console.log("å­˜å®Œåæœ¬åœ°çš„tokenï¼š",U());else{l.error("ç™»å½•å¤±è´¥ï¼šæœªè·å–åˆ°ç”¨æˆ·ä»¤ç‰Œ"),i.value=!1;return}y(u.token),A(c.userRole),O(c.userInfo),l.success("ç™»å½•æˆåŠŸï¼");const S=P.query.redirect||"/home";await x.push(S);break;case"0004":l.error(n.res_msg||"å­¦å·æˆ–å¯†ç é”™è¯¯");break;case"0003":l.error(n.res_msg||"æƒé™ä¸è¶³ï¼Œæ— æ³•ç™»å½•");break;default:l.error(n.res_msg||"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•")}}catch(o){console.error("ç™»å½•è¯·æ±‚å¼‚å¸¸ï¼š",o),l.error("ç½‘ç»œå¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥")}finally{i.value=!1}}};return(o,e)=>{const p=N("router-link");return _(),V(D,null,{default:b(()=>[r("div",Y,[e[6]||(e[6]=r("h1",{class:"system-title"},"PANNè´¢åŠ¡ç®¡ç†ç³»ç»Ÿ",-1)),r("div",z,[k(r("input",{type:"text",placeholder:"å­¦å·",class:"input-field","onUpdate:modelValue":e[0]||(e[0]=a=>s.student_number=a),onBlur:e[1]||(e[1]=a=>f("student_number"))},null,544),[[$,s.student_number]]),t.student_number?(_(),w("div",H,m(t.student_number),1)):h("",!0)]),r("div",J,[k(r("input",{type:d.value?"text":"password",placeholder:"å¯†ç ",class:"input-field","onUpdate:modelValue":e[2]||(e[2]=a=>s.password=a),onBlur:e[3]||(e[3]=a=>f("password")),style:{"padding-right":"30px"}},null,40,K),[[I,s.password]]),r("span",{onClick:e[4]||(e[4]=a=>d.value=!d.value),style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",cursor:"pointer",color:"#999","user-select":"none"}},m(d.value?"ğŸ‘":"ğŸ‘ï¸â€ğŸ—¨ï¸"),1),t.password?(_(),w("div",Q,m(t.password),1)):h("",!0)]),r("div",W,[L(p,{to:"/register"},{default:b(()=>[...e[5]||(e[5]=[T("æ²¡æœ‰è´¦å·ï¼Œæ³¨å†Œ",-1)])]),_:1})]),r("button",{class:"login-btn",onClick:R,disabled:i.value},m(i.value?"ç™»å½•ä¸­...":"ç™»å½•"),9,X)])]),_:1})}}},ue=F(Z,[["__scopeId","data-v-4a2e205f"]]);export{ue as default};

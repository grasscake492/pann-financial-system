import{e as u,t as $,f as W,n as _e,b as ye,o,M as ke,G as e,F as i,P as b,J as B,O as c,aE as F,an as _,U as I,a9 as T,S as n,_ as ge,u as le,R as L}from"./vue-Bt10MVH5.js";import{P as Ce}from"./PageBackground2-DLBYLWUD.js";import{a as we,r as De,u as se}from"./feedback-CSX88a8d.js";import{F as Ue,a as $e}from"./feedbackStatus-DqnZOqTf.js";import{a as he,d as Me,u as Ve,b as Fe}from"./royalty-Czg1kzqr.js";import{h5 as Le,fS as a,fT as Re,hg as Se}from"./index-BWnjimtD.js";import{g as xe}from"./Navbar-CY2pEkqo.js";import"./crypto-DOZa04kq.js";const Ee={class:"tab-buttons"},Be={key:0},Ie={class:"query-form"},Te={class:"task-table"},Pe={key:0},qe=["onClick"],Ae=["onClick"],Ne={key:0,class:"pagination"},ze=["disabled"],je=["disabled"],Ke={key:1,class:"dialog-mask"},Oe={class:"dialog-content"},Qe={class:"form-item"},Ge={class:"form-item"},Je={class:"form-item"},We={class:"form-item"},He={class:"dialog-btns"},Xe={key:2},Ye={class:"manage-form"},Ze={key:0,class:"selected-members"},et=["onClick"],tt={class:"form-item"},lt={class:"form-item"},st={class:"form-item"},at={class:"form-item"},nt=["disabled"],ot={class:"modal-body"},it={key:0,class:"user-list"},rt={class:"user-info"},ut=["onClick","disabled"],dt={key:1,class:"empty-tip"},ct={key:3},vt={class:"feedback-filter"},pt={class:"feedback-item-list"},mt={key:0,class:"empty-tip"},bt={class:"feedback-header"},ft={class:"feedback-id"},_t={class:"feedback-content"},yt={class:"feedback-actions"},kt=["onClick"],gt=["onClick"],Ct={key:0,class:"pagination"},wt=["disabled"],Dt=["disabled"],Ut={key:1,class:"dialog-mask"},$t={class:"dialog-content"},ht={key:2,class:"dialog-mask"},Mt={class:"dialog-content"},Vt={__name:"ManageCenter",setup(Ft){const P=u(!1),h=u([]),p=u([]),C=u([]),R=u([]),H=u(0),f=u(""),S=u(""),w=u(""),y=u(1),q=u(2),g=$({startDate:"",endDate:"",page:1,size:10,user_id:""}),A=W(()=>Math.ceil(H.value/g.size)||1),X=()=>{let s=[...C.value];if(f.value&&(s=s.filter(t=>t.statistical_month?.endsWith(f.value))),S.value){const t=S.value.trim().toLowerCase();s=s.filter(l=>l.article_title?.toLowerCase().includes(t))}R.value=s},M=async()=>{try{const s=await he(g);s.res_code==="0000"?(C.value=s.data.list||[],H.value=s.data.total||0,X()):(a.error(`查询稿费失败：${s.res_msg}`),C.value=[],R.value=[])}catch{a.error("网络异常，查询稿费失败"),C.value=[],R.value=[]}},Y=s=>{s<1||s>A.value||(g.page=s,M())},x=u(!1),N=u({}),v=$({article_title:"",article_type:"",fee_amount:0,statistical_month:"",description:""}),ae=s=>{N.value=s,v.article_title=s.article_title,v.article_type=s.article_type,v.fee_amount=s.fee_amount,v.statistical_month=s.statistical_month,v.description=s.description||"",x.value=!0},ne=async()=>{try{const s=await Ve(N.value.record_id,v);s.res_code==="0000"?(a.success("修改成功"),x.value=!1,await M()):a.error(`修改失败：${s.res_msg}`)}catch{a.error("网络异常，修改失败")}},oe=async s=>{try{if(!await Re.confirm("确定要删除这条稿费记录吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const l=await Me(s);l.res_code==="0000"?(a.success("删除成功"),await M()):a.error(`删除失败：${l.res_msg}`)}catch(t){t!=="cancel"&&a.error("网络异常，删除失败")}},r=$({article_title:"",fee_amount:"",statistical_month:"2026-01",department_id:""}),ie=async()=>{P.value=!0;try{const s=await xe(),t=await Se({page:1,size:100,sign:s});t.res_code==="0000"?h.value=t.data.list||[]:(a.error(`加载用户列表失败：${t.res_msg}`),h.value=[])}catch{a.error("网络异常，加载用户列表失败"),h.value=[]}},z=()=>{P.value=!1},re=s=>{if(p.value.some(t=>t.user_id===s.user_id)){a.warning(`已选择过${s.real_name}，请勿重复选择`);return}p.value.push({user_id:s.user_id,real_name:s.real_name,student_number:s.student_number}),a.success(`已选择 ${s.real_name}`)},ue=s=>{p.value.splice(s,1),a.success("已删除该成员")},de=async()=>{if(p.value.length===0){a.warning("请至少选择一名成员");return}if(!r.article_title){a.warning("请输入稿件标题");return}if(!r.fee_amount||Number(r.fee_amount)<=0){a.warning("请输入有效的稿费金额（大于0）");return}if(!r.statistical_month){a.warning("请选择统计月份");return}if(!r.department_id){a.warning("请选择/输入部门ID");return}const s={user_id:p.value.map(t=>t.user_id),real_names:p.value.map(t=>t.real_name),student_numbers:p.value.map(t=>t.student_number),article_title:r.article_title,article_type:r.article_type,fee_amount:Number(r.fee_amount),statistical_month:r.statistical_month,department_id:Number(r.department_id)};try{const t=await Fe(s);t.res_code==="0000"?(a.success("添加稿费记录成功"),Object.keys(r).forEach(l=>{r[l]=""}),p.value=[],m.value="query",M()):a.error(`添加失败：${t.res_msg}`)}catch(t){a.error("网络异常，添加失败"),console.error("添加稿费失败详情：",t)}},m=u("query"),D=u([]),ce=u(0),j=$({page:1,size:100,status:""}),K=u(!1),k=u(""),U=$({reply_content:""}),O=u(!1),V=$({status:"pending"}),Q=W(()=>{let s=[...D.value];if(f.value&&(s=s.filter(d=>d.created_at?.split("-")[1]===f.value.padStart(2,"0"))),w.value){const d=w.value.trim().toLowerCase();s=s.filter(J=>J.real_name?.toLowerCase().includes(d))}const t=(y.value-1)*q.value,l=t+q.value;return s.slice(t,l)}),G=W(()=>{let s=[...D.value];if(f.value&&(s=s.filter(t=>t.created_at?.split("-")[1]===f.value.padStart(2,"0"))),w.value){const t=w.value.trim().toLowerCase();s=s.filter(l=>l.real_name?.toLowerCase().includes(t))}return Math.ceil(s.length/q.value)||1}),E=async()=>{try{const s=await we(j);s.res_code==="0000"?(D.value=s.data.list||[],ce.value=s.data.total||0,y.value=1):(a.error(`查询失败：${s.res_msg}`),D.value=[])}catch{a.error("网络异常，查询反馈失败"),D.value=[]}},ve=()=>{y.value=1},Z=s=>{s<1||s>G.value||(y.value=s)},pe=s=>{k.value=s,U.reply_content="",K.value=!0},ee=()=>{K.value=!1,k.value="",U.reply_content=""},me=async()=>{if(!U.reply_content.trim()){a.warning("请输入回复内容");return}try{const s=await De(k.value,{reply_content:U.reply_content});s.res_code==="0000"?(a.success("回复成功"),ee(),await se(k.value,{status:"replied"}),await E()):a.error(`回复失败：${s.res_msg}`)}catch{a.error("网络异常，回复失败")}},be=s=>{k.value=s;const t=D.value.find(l=>l.feedback_id===s);t&&(V.status=t.status||"pending"),O.value=!0},te=()=>{O.value=!1,k.value="",V.status="pending"},fe=async()=>{try{const s=await se(k.value,{status:V.status});s.res_code==="0000"?(a.success("状态更新成功"),te(),await E()):a.error(`状态更新失败：${s.res_msg}`)}catch{a.error("网络异常，状态更新失败")}};return _e(()=>{console.log("进入新闻部，组件挂载，开始初始化数据"),m.value==="query"&&M(),m.value==="feedback"&&E()}),(s,t)=>(o(),ye(Ce,null,{"card-content":ke(()=>[e("div",Ee,[e("button",{class:B(["tab-btn",{active:m.value==="query"}]),onClick:t[0]||(t[0]=l=>m.value="query")}," 任务查询 ",2),e("button",{class:B(["tab-btn",{active:m.value==="manage"}]),onClick:t[1]||(t[1]=l=>m.value="manage")}," 任务管理 ",2),e("button",{class:B(["tab-btn",{active:m.value==="feedback"}]),onClick:t[2]||(t[2]=()=>{m.value="feedback",E()})}," 查看反馈 ",2)]),m.value==="query"?(o(),i("div",Be,[e("div",Ie,[t[25]||(t[25]=e("label",null,"选择月份:",-1)),c(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=l=>f.value=l)},[...t[24]||(t[24]=[e("option",{value:""},"全部",-1),e("option",{value:"01"},"1月",-1),e("option",{value:"02"},"2月",-1),e("option",{value:"03"},"3月",-1),e("option",{value:"04"},"4月",-1),e("option",{value:"05"},"5月",-1),e("option",{value:"06"},"6月",-1),e("option",{value:"07"},"7月",-1),e("option",{value:"08"},"8月",-1),e("option",{value:"09"},"9月",-1),e("option",{value:"10"},"10月",-1),e("option",{value:"11"},"11月",-1),e("option",{value:"12"},"12月",-1)])],512),[[F,f.value]]),t[26]||(t[26]=e("label",null,"任务名称:",-1)),c(e("input",{type:"text",placeholder:"输入任务名称查询",class:"form-input","onUpdate:modelValue":t[4]||(t[4]=l=>S.value=l)},null,512),[[_,S.value]]),e("button",{class:"query-btn",onClick:X},"查询")]),e("table",Te,[t[28]||(t[28]=e("thead",null,[e("tr",null,[e("th",null,"任务名称"),e("th",null,"参与人"),e("th",null,"学号"),e("th",null,"稿费金额"),e("th",null,"统计月份"),e("th",null,"操作")])],-1)),e("tbody",null,[C.value.length===0?(o(),i("tr",Pe,[...t[27]||(t[27]=[e("td",{colspan:"9",class:"empty-tip"},"暂无稿费记录",-1)])])):b("",!0),(o(!0),i(I,null,T(R.value,l=>(o(),i("tr",{key:l.record_id},[e("td",null,n(l.article_title),1),e("td",null,n(l.real_names?.join(", ")||"-"),1),e("td",null,n(l.student_numbers?.join(", ")||"-"),1),e("td",null,n(l.fee_amount),1),e("td",null,n(l.statistical_month),1),e("td",null,[e("button",{class:"op-btn",onClick:d=>ae(l)},"修改",8,qe),e("button",{class:"op-btn",onClick:d=>oe(l.record_id)},"删除",8,Ae)])]))),128))])]),C.value.length>0?(o(),i("div",Ne,[e("button",{class:"page-btn",onClick:t[5]||(t[5]=l=>Y(g.page-1)),disabled:g.page<=1}," 上一页 ",8,ze),e("span",null,"第"+n(g.page)+"页 / 共"+n(A.value)+"页",1),e("button",{class:"page-btn",onClick:t[6]||(t[6]=l=>Y(g.page+1)),disabled:g.page>=A.value}," 下一页 ",8,je)])):b("",!0)])):b("",!0),x.value?(o(),i("div",Ke,[e("div",Oe,[e("h4",null,"修改稿费记录（ID: "+n(N.value.record_id)+"）",1),e("div",Qe,[t[29]||(t[29]=e("label",null,"稿件标题:",-1)),c(e("input",{type:"text",class:"form-input","onUpdate:modelValue":t[7]||(t[7]=l=>v.article_title=l)},null,512),[[_,v.article_title]])]),e("div",Ge,[t[30]||(t[30]=e("label",null,"稿费金额:",-1)),c(e("input",{type:"number",step:"1",class:"form-input","onUpdate:modelValue":t[8]||(t[8]=l=>v.fee_amount=l)},null,512),[[_,v.fee_amount]])]),e("div",Je,[t[31]||(t[31]=e("label",null,"统计月份:",-1)),c(e("input",{type:"month",class:"form-input","onUpdate:modelValue":t[9]||(t[9]=l=>v.statistical_month=l)},null,512),[[_,v.statistical_month]])]),e("div",We,[t[32]||(t[32]=e("label",null,"备注:",-1)),c(e("textarea",{class:"form-textarea","onUpdate:modelValue":t[10]||(t[10]=l=>v.description=l)},null,512),[[_,v.description]])]),e("div",He,[e("button",{class:"cancel-btn",onClick:t[11]||(t[11]=l=>x.value=!1)},"取消"),e("button",{class:"feedback-confirm-btn",onClick:ne},"确认修改")])])])):b("",!0),m.value==="manage"?(o(),i("div",Xe,[t[40]||(t[40]=e("div",{class:"manage-title"},[e("div",{class:"title-line"}),e("h3",null,"添加稿费记录")],-1)),e("div",Ye,[e("div",{class:"form-item"},[e("button",{class:"select-member-btn",onClick:ie},"选择成员")]),p.value.length>0?(o(),i("div",Ze,[t[33]||(t[33]=e("h4",null,"已选成员：",-1)),(o(!0),i(I,null,T(p.value,(l,d)=>(o(),i("div",{class:"member-item",key:l.user_id},[e("span",null,"成员"+n(d+1)+"：姓名="+n(l.real_name)+"，学号="+n(l.student_number)+"，ID="+n(l.user_id),1),e("button",{class:"del-member-btn",onClick:J=>ue(d)},"删除",8,et)]))),128))])):b("",!0),e("div",tt,[t[34]||(t[34]=e("label",null,"稿件标题:",-1)),c(e("input",{type:"text",placeholder:"输入稿件标题",class:"form-input","onUpdate:modelValue":t[12]||(t[12]=l=>r.article_title=l)},null,512),[[_,r.article_title]])]),e("div",lt,[t[35]||(t[35]=e("label",null,"稿费金额:",-1)),c(e("input",{type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"form-input","onUpdate:modelValue":t[13]||(t[13]=l=>r.fee_amount=l)},null,512),[[_,r.fee_amount]])]),e("div",st,[t[36]||(t[36]=e("label",null,"统计月份:",-1)),c(e("input",{type:"month",class:"form-input","onUpdate:modelValue":t[14]||(t[14]=l=>r.statistical_month=l),min:"2026-01"},null,512),[[_,r.statistical_month]])]),e("div",at,[t[38]||(t[38]=e("label",null,"所属部门:",-1)),c(e("select",{class:"form-select","onUpdate:modelValue":t[15]||(t[15]=l=>r.department_id=l)},[...t[37]||(t[37]=[e("option",{value:""},"请选择部门",-1),e("option",{value:"1"},"新闻部",-1),e("option",{value:"2"},"编辑部",-1),e("option",{value:"3"},"运营部",-1)])],512),[[F,r.department_id]])]),e("button",{class:"submit-btn",onClick:de,disabled:p.value.length===0},"提交添加",8,nt)]),P.value?(o(),i("div",{key:0,class:"modal-mask",onClick:z},[e("div",{class:"modal-content",onClick:t[16]||(t[16]=ge(()=>{},["stop"]))},[e("div",{class:"modal-header"},[t[39]||(t[39]=e("h3",null,"选择成员",-1)),e("button",{class:"close-modal",onClick:z},"×")]),e("div",ot,[h.value.length>0?(o(),i("div",it,[(o(!0),i(I,null,T(h.value,l=>(o(),i("div",{class:"user-item",key:l.user_id},[e("div",rt,[e("span",null,"姓名："+n(l.real_name),1),e("span",null,"学号："+n(l.student_number),1),e("span",null,"ID："+n(l.user_id),1)]),e("button",{class:"select-user-btn",onClick:d=>re(l),disabled:p.value.some(d=>d.user_id===l.user_id)},n(p.value.some(d=>d.user_id===l.user_id)?"已选择":"选择"),9,ut)]))),128))])):(o(),i("div",dt,"暂无用户数据"))]),e("div",{class:"modal-footer"},[e("button",{class:"user-modal-confirm-btn",onClick:z},"确认选择")])])])):b("",!0)])):b("",!0),m.value==="feedback"?(o(),i("div",ct,[e("div",vt,[t[43]||(t[43]=e("label",null,"反馈状态:",-1)),c(e("select",{class:"form-select","onUpdate:modelValue":t[17]||(t[17]=l=>j.status=l)},[...t[41]||(t[41]=[e("option",{value:""},"全部",-1),e("option",{value:"pending"},"待处理",-1),e("option",{value:"replied"},"已回复",-1)])],512),[[F,j.status]]),t[44]||(t[44]=e("label",null,"月份:",-1)),c(e("select",{class:"form-select","onUpdate:modelValue":t[18]||(t[18]=l=>f.value=l)},[...t[42]||(t[42]=[e("option",{value:""},"全部",-1),e("option",{value:"1"},"1月",-1),e("option",{value:"2"},"2月",-1),e("option",{value:"3"},"3月",-1),e("option",{value:"4"},"4月",-1),e("option",{value:"5"},"5月",-1),e("option",{value:"6"},"6月",-1),e("option",{value:"7"},"7月",-1),e("option",{value:"8"},"8月",-1),e("option",{value:"9"},"9月",-1),e("option",{value:"10"},"10月",-1),e("option",{value:"11"},"11月",-1),e("option",{value:"12"},"12月",-1)])],512),[[F,f.value]]),t[45]||(t[45]=e("label",null,"用户姓名:",-1)),c(e("input",{type:"text",placeholder:"输入姓名模糊查询",class:"form-input","onUpdate:modelValue":t[19]||(t[19]=l=>w.value=l)},null,512),[[_,w.value]]),e("button",{class:"query-btn",onClick:ve},"查询")]),e("div",pt,[Q.value.length===0?(o(),i("div",mt,"暂无反馈数据")):b("",!0),(o(!0),i(I,null,T(Q.value,l=>(o(),i("div",{class:"feedback-item",key:l.feedback_id},[e("div",bt,[e("span",ft,"反馈ID："+n(l.feedback_id),1),e("span",{class:B(["status-tag",le(Ue)[l.status]])},n(le($e)[l.status]),3)]),e("div",_t,[e("p",null,[t[46]||(t[46]=e("span",{class:"label"},"反馈用户：",-1)),L(n(l.real_name),1)]),e("p",null,[t[47]||(t[47]=e("span",{class:"label"},"反馈内容：",-1)),L(n(l.content),1)]),e("p",null,[t[48]||(t[48]=e("span",{class:"label"},"反馈时间：",-1)),L(n(l.created_at),1)]),e("p",null,[t[49]||(t[49]=e("span",{class:"label"},"回复时间：",-1)),L(n(l.replied_at||"未回复"),1)]),e("p",null,[t[50]||(t[50]=e("span",{class:"label"},"回复内容：",-1)),L(n(l.reply_content||"暂无回复"),1)])]),e("div",yt,[e("button",{class:"op-btn reply-btn",onClick:d=>pe(l.feedback_id)},"回复",8,kt),e("button",{class:"op-btn status-btn",onClick:d=>be(l.feedback_id)},"改状态",8,gt)])]))),128))]),Q.value.length>0?(o(),i("div",Ct,[e("button",{class:"page-btn",onClick:t[20]||(t[20]=l=>Z(y.value-1)),disabled:y.value<=1}," 上一页 ",8,wt),e("span",null,"第"+n(y.value)+"页 / 共"+n(G.value)+"页",1),e("button",{class:"page-btn",onClick:t[21]||(t[21]=l=>Z(y.value+1)),disabled:y.value>=G.value}," 下一页 ",8,Dt)])):b("",!0),K.value?(o(),i("div",Ut,[e("div",$t,[e("h4",null,"回复反馈（ID: "+n(k.value)+"）",1),c(e("textarea",{placeholder:"请输入回复内容",class:"reply-textarea","onUpdate:modelValue":t[22]||(t[22]=l=>U.reply_content=l)},null,512),[[_,U.reply_content]]),e("div",{class:"dialog-btns"},[e("button",{class:"cancel-btn",onClick:ee},"取消"),e("button",{class:"feedback-confirm-btn",onClick:me},"提交回复")])])])):b("",!0),O.value?(o(),i("div",ht,[e("div",Mt,[e("h4",null,"更新反馈状态（ID: "+n(k.value)+"）",1),c(e("select",{class:"form-select","onUpdate:modelValue":t[23]||(t[23]=l=>V.status=l)},[...t[51]||(t[51]=[e("option",{value:"pending"},"待处理",-1),e("option",{value:"replied"},"已回复",-1)])],512),[[F,V.status]]),e("div",{class:"dialog-btns"},[e("button",{class:"cancel-btn",onClick:te},"取消"),e("button",{class:"feedback-confirm-btn",onClick:fe},"确认更新")])])])):b("",!0)])):b("",!0)]),_:1}))}},Pt=Le(Vt,[["__scopeId","data-v-4be2e33d"]]);export{Pt as default};

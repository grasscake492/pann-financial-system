import{aB as te,e as d,t as E,f as Q,n as ae,r as V,b as se,o as p,M as u,G as t,V as k,O as h,J as T,an as U,F as m,P as B,U as A,a9 as G,S as n,u as R,R as N,W as J}from"./vue-Bt10MVH5.js";import{P as le}from"./PageBackground2-DLBYLWUD.js";import{g as ne}from"./royalty-Czg1kzqr.js";import{g as oe,s as re}from"./feedback-CSX88a8d.js";import{f as de,a as O,b as ue}from"./Navbar-CY2pEkqo.js";import{h5 as ie,h6 as ce,fS as f}from"./index-BWnjimtD.js";import{u as pe}from"./notice-D1oFNx-S.js";import"./crypto-DOZa04kq.js";import"./announcement-p87uQSgg.js";const fe={class:"tab-container"},me={class:"tab-header"},ve={class:"tab-content"},be={class:"query-area"},ge=["min"],_e={class:"fee-table"},ke={key:0},ye=["onClick"],De={class:"total-area"},Ce={class:"total-amount"},we={class:"pagination-area"},Ve=["disabled"],he={class:"page-info"},$e=["disabled"],Me={class:"tab-content"},Fe={class:"feedback-table"},Ne={key:0},Se={class:"content-cell"},xe={class:"reply-cell"},Pe={key:0,class:"pagination-area"},ze=["disabled"],Le={class:"page-info"},Te=["disabled"],Ue={__name:"RoyaltyDetail",setup(Be){te();const S=ce();pe();const v=d("fee"),b=d([]),o=E({page:1,size:10}),y=d(0),x=Q(()=>Math.ceil(y.value/o.size)),g=d(!1),W=d({}),i=d({content:"",feedback_id:""}),a=E({startDate:"2026-01-01",endDate:"",taskName:"",page:1,size:10}),D=d([]),$=d(0),M=d(0),P=Q(()=>Math.ceil($.value/a.size)),q=()=>{const s=new Date,e=s.getFullYear(),C=String(s.getMonth()+1).padStart(2,"0"),w=String(s.getDate()).padStart(2,"0");return`${e}-${C}-${w}`},Y=s=>s?ue(s).split(" ")[0]:"",F=async()=>{if(a.startDate&&a.endDate&&new Date(a.endDate)<new Date(a.startDate)){f.error("结束日期不能早于开始日期，请重新选择");return}try{const s={startDate:a.startDate,endDate:a.endDate,page:a.page,size:a.size},e=await ne(s);if(e.res_code==="0000"){const{total:C,list:w}=e.data;$.value=C;let _=w.filter(r=>{const c=r.created_at?r.created_at.split(" ")[0]:"";return!a.startDate&&!a.endDate?!0:a.startDate&&!a.endDate?c>=a.startDate:(!a.startDate&&a.endDate||c>=a.startDate)&&c<=a.endDate});a.taskName&&(_=_.filter(r=>r.article_title?.toLowerCase().includes(a.taskName.toLowerCase()))),D.value=_,M.value=_.reduce((r,c)=>r+(Number(c.fee_amount)||0),0)}else alert(`查询失败：${e.res_msg}`),D.value=[],$.value=0,M.value=0}catch(s){console.error("查询稿费明细失败：",s),alert("网络异常，查询失败"),D.value=[],$.value=0,M.value=0}},H=()=>{a.startDate="2026-01-01";const s=q();a.endDate=s<"2026-01-01"?"2026-01-01":s,a.taskName="",a.page=1,F()},I=s=>{s<1||s>P.value||(a.page=s,F())},K=s=>{W.value=s,i.value={content:"",feedback_id:s.feedback_id},g.value=!0},X=async()=>{if(!i.value.content.trim()){f.error("请填写反馈理由");return}if(!S.userInfo?.user_id){f.error("请先登录"),g.value=!1;return}const s={user_id:S.userInfo.user_id,content:i.value.content,feedback_id:i.value.feedback_id};try{const e=await re(s);e.res_code==="0000"?(f.success("反馈提交成功！"),g.value=!1,i.value.content="",z()):f.error(`提交失败：${e.data?.res_msg||"未知错误"}`)}catch(e){f.error("网络异常，提交失败"),console.error("反馈提交失败:",e)}},Z=s=>({pending:"待处理",replied:"已回复"})[s]||"未知状态",ee=s=>({pending:"status-pending",replied:"status-replied",resolved:"status-resolved",rejected:"status-rejected"})[s]||"",z=async()=>{if(S.userInfo?.user_id)try{const s=await oe({page:o.page,size:o.size});s.res_code==="0000"?(b.value=s.data.list||[],y.value=s.data.total||0):(f.error(`获取反馈列表失败：${s.res_msg}`),b.value=[],y.value=0)}catch(s){f.error("网络异常，获取反馈列表失败"),console.error("获取反馈列表失败:",s),b.value=[],y.value=0}},j=s=>{s<1||s>x.value||(o.page=s,z())};return ae(()=>{const s=q();a.endDate=s<a.startDate?a.startDate:s,F(),z()}),(s,e)=>{const C=V("el-input"),w=V("el-form-item"),_=V("el-form"),r=V("el-button"),c=V("el-dialog");return p(),se(le,null,{"page-title":u(()=>[...e[12]||(e[12]=[N("我的稿费与反馈",-1)])]),"card-content":u(()=>[t("div",fe,[t("div",me,[t("div",{class:T(["tab-item",{active:v.value==="fee"}]),onClick:e[0]||(e[0]=l=>v.value="fee")}," 我的稿费明细 ",2),t("div",{class:T(["tab-item",{active:v.value==="feedback"}]),onClick:e[1]||(e[1]=l=>v.value="feedback")}," 我的反馈记录 ",2)]),h(t("div",ve,[t("div",be,[e[13]||(e[13]=t("label",null,"开始日期:",-1)),h(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=l=>a.startDate=l),class:"date-input",min:"2026-01-01"},null,512),[[U,a.startDate]]),e[14]||(e[14]=t("label",{class:"ml-20"},"结束日期:",-1)),h(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=l=>a.endDate=l),class:"date-input",min:a.startDate||"2026-01-01"},null,8,ge),[[U,a.endDate]]),e[15]||(e[15]=t("label",{class:"ml-20"},"任务名称:",-1)),h(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=l=>a.taskName=l),placeholder:"输入任务名称查询",class:"task-input"},null,512),[[U,a.taskName]]),t("button",{class:"query-btn",onClick:F},"查询"),t("button",{class:"reset-btn ml-20",onClick:H},"重置")]),t("table",_e,[e[18]||(e[18]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"任务名称"),t("th",null,"部门"),t("th",null,"金额"),t("th",null,"操作")])],-1)),t("tbody",null,[D.value.length===0?(p(),m("tr",ke,[...e[16]||(e[16]=[t("td",{colspan:"6",class:"empty-tip"},"暂无稿费数据",-1)])])):B("",!0),(p(!0),m(A,null,G(D.value,(l,L)=>(p(),m("tr",{key:l.feedback_id||L},[t("td",null,n(l.statistical_month||"-"),1),t("td",null,n(l.article_title||"-"),1),t("td",null,n(R(de)(l.department_id)),1),t("td",null,n(R(O)(l.fee_amount))+"元",1),t("td",null,[t("button",{class:"feedback-btn",onClick:Re=>K(l)},"反馈",8,ye)])]))),128))]),t("template",De,[e[17]||(e[17]=N(" 共计: ",-1)),t("span",Ce,n(R(O)(M.value))+"元",1)])]),t("div",we,[t("button",{class:"page-btn",onClick:e[5]||(e[5]=l=>I(a.page-1)),disabled:a.page<=1},"上一页",8,Ve),t("span",he," 第"+n(a.page)+"页 / 共"+n(P.value)+"页 ",1),t("button",{class:"page-btn",onClick:e[6]||(e[6]=l=>I(a.page+1)),disabled:a.page>=P.value},"下一页",8,$e)])],512),[[J,v.value==="fee"]]),h(t("div",Me,[t("table",Fe,[e[20]||(e[20]=t("thead",null,[t("tr",null,[t("th",null,"稿费名称"),t("th",null,"反馈内容"),t("th",null,"提交时间"),t("th",null,"反馈状态"),t("th",null,"管理员回复")])],-1)),t("tbody",null,[!b.value||b.value.length===0?(p(),m("tr",Ne,[...e[19]||(e[19]=[t("td",{colspan:"6",class:"empty-tip"},"暂无反馈记录",-1)])])):B("",!0),(p(!0),m(A,null,G(b.value,(l,L)=>(p(),m("tr",{key:l.feedback_id||L},[t("td",null,n(l.feedback_id||"-"),1),t("td",Se,n(l.content||"-"),1),t("td",null,n(Y(l.created_at)||"-"),1),t("td",null,[t("span",{class:T(["status-tag",ee(l.status)])},n(Z(l.status)),3)]),t("td",xe,n(l.reply_content||"暂无回复"),1)]))),128))])]),y.value>0?(p(),m("div",Pe,[t("button",{class:"page-btn",onClick:e[7]||(e[7]=l=>j(o.page-1)),disabled:o.page<=1},"上一页",8,ze),t("span",Le," 第"+n(o.page)+"页 / 共"+n(x.value)+"页 ",1),t("button",{class:"page-btn",onClick:e[8]||(e[8]=l=>j(o.page+1)),disabled:o.page>=x.value},"下一页",8,Te)])):B("",!0)],512),[[J,v.value==="feedback"]])]),k(c,{modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=l=>g.value=l),title:"提交稿费反馈",width:"400px",modal:!1,class:"no-shadow-dialog"},{footer:u(()=>[k(r,{onClick:e[10]||(e[10]=l=>g.value=!1)},{default:u(()=>[...e[21]||(e[21]=[N("取消",-1)])]),_:1}),k(r,{type:"primary",onClick:X},{default:u(()=>[...e[22]||(e[22]=[N("提交",-1)])]),_:1})]),default:u(()=>[k(_,{model:i.value,"label-width":"80px"},{default:u(()=>[k(w,{label:"反馈理由",required:""},{default:u(()=>[k(C,{modelValue:i.value.content,"onUpdate:modelValue":e[9]||(e[9]=l=>i.value.content=l),type:"textarea",rows:4,placeholder:"请输入您的反馈问题（如稿费金额错误、漏算等）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),default:u(()=>[e[23]||(e[23]=t("div",{class:"title-line"},null,-1))]),_:1})}}},We=ie(Ue,[["__scopeId","data-v-582fab28"]]);export{We as default};

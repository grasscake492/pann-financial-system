import{aB as g,e as _,n as f,b as h,o,M as d,V as k,G as a,F as c,P as y,U as x,a9 as b,S as r,R as A}from"./vue-Bt10MVH5.js";import{g as E,N as B}from"./Navbar-CY2pEkqo.js";import{A as N}from"./AnnounceBackground-BE4JT0jN.js";import{g as w}from"./announcement-p87uQSgg.js";import{h5 as V,h8 as C,fS as u}from"./index-BWnjimtD.js";import"./crypto-DOZa04kq.js";const D={class:"announcement-container"},M={class:"announcement-list"},F={key:0,class:"empty-tip"},I={key:1,class:"empty-tip"},L=["onClick"],R={class:"announcement-date"},S={class:"announcement-content"},T={key:0,class:"content-title"},z={key:1,class:"content-expanded"},G={class:"content-title"},P={class:"content-body"},U={class:"content-footer"},$={__name:"Announcement",setup(j){const p=g(),s=_([]),i=_(!0);console.log("普通用户");const m=e=>e?e.split(" ")[0]||e:"未知时间";f(async()=>{try{if(!C()){u.warning("请先登录"),await p.push("/login");return}i.value=!0;const n=await w({page:1,size:20,order_by:"published_at",sort:"desc",sign:E({timestamp:Date.now()})});if(i.value=!1,n.res_code==="0000"){const t=n.data?.list||[];Array.isArray(t)&&(s.value=t.map(l=>({...l,isExpanded:!1})))}else u.error(n.res_msg||"获取公告失败")}catch(e){i.value=!1,console.error("请求公告失败（网络错误）：",e),s.value=[],u.error("获取公告失败，请稍后重试")}console.log("最终渲染的公告列表：",s.value)});const v=e=>{const n=s.value[e];s.value[e]={...n,isExpanded:!n.isExpanded}};return(e,n)=>(o(),h(N,null,{"page-title":d(()=>[...n[0]||(n[0]=[A("所有公告",-1)])]),"card-content":d(()=>[a("div",D,[a("div",M,[i.value?(o(),c("div",F,"加载中...")):s.value.length===0?(o(),c("div",I," 暂无公告 ")):y("",!0),(o(!0),c(x,null,b(s.value,(t,l)=>(o(),c("div",{class:"announcement-item",key:t.announcement_id,onClick:q=>v(l)},[a("div",R,"["+r(m(t.published_at))+"]",1),a("div",S,[t.isExpanded?(o(),c("div",z,[a("div",G,r(t.title),1),a("div",P,r(t.content),1),a("div",U,"发布人ID："+r(t.publisher_id),1)])):(o(),c("div",T,r(t.title),1))])],8,L))),128))])])]),default:d(()=>[k(B,{style:{"background-color":"transparent!important"}})]),_:1}))}},X=V($,[["__scopeId","data-v-f10ae72f"]]);export{X as default};

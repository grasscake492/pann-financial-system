import{aB as $,aC as C,f,m as k,n as h,F as p,o as _,G as u,P as N,J as c,p as g}from"./vue-Bt10MVH5.js";import{hj as R,h5 as U,h6 as D,hc as M}from"./index-BWnjimtD.js";const b=(o={})=>{const m=`${Object.keys(o).sort().map(a=>`${a}=${o[a]}`).join("&")}your_backend_secret`;return R(m)},B=o=>{if(!o)return"";const s=new Date(o),i=s.getFullYear(),e=String(s.getMonth()+1).padStart(2,"0"),m=String(s.getDate()).padStart(2,"0"),a=String(s.getHours()).padStart(2,"0"),d=String(s.getMinutes()).padStart(2,"0");return`${i}-${e}-${m} ${a}:${d}`},K=o=>{if(!o&&o!==0)return"0.00";const s=Number(o);return isNaN(s)?"0.00":s.toFixed(2)},T=o=>({1:"新闻部",2:"编辑部",3:"运营部"})[o]||"未知部门",w={class:"navbar"},P={class:"nav-menu"},x={__name:"Navbar",setup(o){const s=$(),i=C(),e=D(),m=f(()=>{const n=e.userInfo.is_super_admin===!0,t=!!e.userInfo.admin_id&&!!e.userInfo.department_id;return n||t}),a={2:"EditorCenter",1:"NewsCenter",3:"OperationCenter"},d=f(()=>{if(!e.userInfo)return!1;let n="";return e.userInfo.is_super_admin?n="SystemManage":e.userInfo.admin_id&&e.userInfo.department_id&&(n=a[e.userInfo.department_id]||""),i.name===n}),I=f(()=>{const t=e.userInfo.is_super_admin||!!e.userInfo.admin_id?"AdminAnnouncement":"UserAnnouncement";return i.name===t}),l=n=>{s.push({name:n})},v=()=>{let n="";e.userInfo.is_super_admin?n="SystemManage":e.userInfo.admin_id&&e.userInfo.department_id&&(n=a[e.userInfo.department_id]||""),n?s.getRoutes().some(r=>r.name===n)?s.push({name:n}):alert(`暂无【${e.userInfo.department_name}】对应的管理页面！`):(alert("暂无管理页面权限！"),s.push({name:"Home"}))},y=()=>{console.log("当前用户:",{is_super_admin:e.userInfo.is_super_admin,admin_id:e.userInfo.admin_id,dept_id:e.userInfo.department_id});const n=e.userInfo.is_super_admin||!!e.userInfo.admin_id;console.log("是否是管理员:",n);const t=n?"AdminAnnouncement":"UserAnnouncement";console.log("目标路由:",t),s.getRoutes().some(S=>S.name===t)?s.push({name:t}):(alert(`路由未注册：${t}，请检查路由表！`),s.push({name:"Home"}))};k([()=>i.name,()=>e.userInfo],()=>{g(()=>{})},{immediate:!0,deep:!0});const A=async()=>{await g();try{if(e.userInfo&&e.userInfo.token&&e.userInfo.real_name){console.log("已有完整用户信息，无需重复拉取，避免覆盖");return}const n=b({timestamp:Date.now()}),t=M(),r=await e.loadUserProfile({token:t,sign:n});if(r&&r.res_code==="0000")console.log("拉取用户信息成功，数据有效");else{console.log("接口返回失败/数据无效，不覆盖原有用户信息");return}console.log("【拉取用户信息后】",e.userInfo)}catch(n){console.error("拉取用户信息失败：",n)}};return h(()=>{if(!e.userInfo.token){s.push({path:"/login"});return}A()}),(n,t)=>(_(),p("div",w,[t[3]||(t[3]=u("div",{class:"system-title"},"PANN财务管理系统",-1)),u("div",P,[u("span",{class:c(["nav-item",{active:n.$route.name==="Home"}]),onClick:t[0]||(t[0]=r=>l("Home"))}," 首页 ",2),u("span",{class:c(["nav-item",{active:n.$route.name==="UserRoyaltyDetail"}]),onClick:t[1]||(t[1]=r=>l("UserRoyaltyDetail"))}," 稿费明细 ",2),u("span",{class:c(["nav-item",{active:n.$route.name==="UserAccount"}]),onClick:t[2]||(t[2]=r=>l("UserAccount"))}," 账户页面 ",2),m.value?(_(),p("span",{key:0,class:c(["nav-item",{active:d.value}]),onClick:v},"管理中心 ",2)):N("",!0),u("span",{class:c(["nav-item",{active:I.value}]),onClick:y}," 公告 ",2)])]))}},j=U(x,[["__scopeId","data-v-84ffe06d"]]);export{j as N,K as a,B as b,T as f,b as g};

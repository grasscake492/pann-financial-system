import{hi as gt,r as u,hl as V,hI as X,f as lt,hn as kt,ho as i,hp as Ct,hq as t,hs as r,ht as b,hS as I,hr as d,hU as F,hu as f,hJ as B,hK as q,hv as n,hy as C,hV as st,hX as wt,b as at,g3 as a,g4 as ht,hW as Ut}from"./index-CAl9Fkbs.js";import{P as Dt}from"./PageBackground2-Ck1v3nqa.js";import{a as Vt,r as $t,u as nt}from"./feedback-CbatGfMo.js";import{F as Mt,a as Lt}from"./feedbackStatus-DqnZOqTf.js";import{a as Ft,d as Rt,u as xt,b as St}from"./royalty-DVaQoL-r.js";import{g as Et}from"./Navbar-kC0yHLwy.js";const It={class:"tab-buttons"},Bt={key:0},qt={class:"query-form"},Tt={class:"task-table"},At={key:0},Pt=["onClick"],Nt=["onClick"],zt={key:0,class:"pagination"},jt=["disabled"],Kt=["disabled"],Qt={key:1,class:"dialog-mask"},Wt={class:"dialog-content"},Jt={class:"form-item"},Ot={class:"form-item"},Xt={class:"form-item"},Gt={class:"form-item"},Ht={class:"form-item"},Yt={class:"dialog-btns"},Zt={key:2},te={class:"manage-form"},ee={key:0,class:"selected-members"},le=["onClick"],se={class:"form-item"},ae={class:"form-item"},ne={class:"radio-group"},oe={class:"radio-item"},ie={class:"radio-item"},re={class:"form-item"},ue={class:"form-item"},de={class:"form-item"},ce=["disabled"],ve={class:"modal-body"},pe={key:0,class:"user-list"},me={class:"user-info"},be=["onClick","disabled"],fe={key:1,class:"empty-tip"},_e={key:3},ye={class:"feedback-filter"},ge={class:"feedback-item-list"},ke={key:0,class:"empty-tip"},Ce={class:"feedback-header"},we={class:"feedback-id"},he={class:"feedback-content"},Ue={class:"feedback-actions"},De=["onClick"],Ve=["onClick"],$e={key:0,class:"pagination"},Me=["disabled"],Le=["disabled"],Fe={key:1,class:"dialog-mask"},Re={class:"dialog-content"},xe={key:2,class:"dialog-mask"},Se={class:"dialog-content"},Ee={__name:"ManageCenter",setup(Ie){const T=u(!1),$=u([]),p=u([]),w=u([]),R=u([]),G=u(0),_=u(""),x=u(""),h=u(""),y=u(1),A=u(2),k=V({startDate:"",endDate:"",page:1,size:10,user_id:""}),P=X(()=>Math.ceil(G.value/k.size)||1),H=()=>{let s=[...w.value];if(_.value&&(s=s.filter(e=>e.statistical_month?.endsWith(_.value))),x.value){const e=x.value.trim().toLowerCase();s=s.filter(l=>l.article_title?.toLowerCase().includes(e))}R.value=s},M=async()=>{try{const s=await Ft(k);s.res_code==="0000"?(w.value=s.data.list||[],G.value=s.data.total||0,H()):(a.error(`查询稿费失败：${s.res_msg}`),w.value=[],R.value=[])}catch{a.error("网络异常，查询稿费失败"),w.value=[],R.value=[]}},Y=s=>{s<1||s>P.value||(k.page=s,M())},S=u(!1),N=u({}),c=V({article_title:"",article_type:"",fee_amount:0,statistical_month:"",description:""}),ot=s=>{N.value=s,c.article_title=s.article_title,c.article_type=s.article_type,c.fee_amount=s.fee_amount,c.statistical_month=s.statistical_month,c.description=s.description||"",S.value=!0},it=async()=>{try{const s=await xt(N.value.record_id,c);s.res_code==="0000"?(a.success("修改成功"),S.value=!1,await M()):a.error(`修改失败：${s.res_msg}`)}catch{a.error("网络异常，修改失败")}},rt=async s=>{try{if(!await ht.confirm("确定要删除这条稿费记录吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const l=await Rt(s);l.res_code==="0000"?(a.success("删除成功"),await M()):a.error(`删除失败：${l.res_msg}`)}catch(e){e!=="cancel"&&a.error("网络异常，删除失败")}},o=V({article_title:"",article_type:"",fee_amount:"",statistical_month:"2026-01",department_id:""}),ut=async()=>{T.value=!0;try{const s=await Et(),e=await Ut({page:1,size:100,sign:s});e.res_code==="0000"?$.value=e.data.list||[]:(a.error(`加载用户列表失败：${e.res_msg}`),$.value=[])}catch{a.error("网络异常，加载用户列表失败"),$.value=[]}},z=()=>{T.value=!1},dt=s=>{if(p.value.some(e=>e.user_id===s.user_id)){a.warning(`已选择过${s.real_name}，请勿重复选择`);return}p.value.push({user_id:s.user_id,real_name:s.real_name,student_number:s.student_number}),a.success(`已选择 ${s.real_name}`)},ct=s=>{p.value.splice(s,1),a.success("已删除该成员")},vt=async()=>{if(p.value.length===0){a.warning("请至少选择一名成员");return}if(!o.article_title){a.warning("请输入稿件标题");return}if(!o.article_type){a.warning("请选择稿件类型（校对/编辑）");return}if(!o.fee_amount||Number(o.fee_amount)<=0){a.warning("请输入有效的稿费金额（大于0）");return}if(!o.statistical_month){a.warning("请选择统计月份");return}if(!o.department_id){a.warning("请选择/输入部门ID");return}const s={user_id:p.value.map(e=>e.user_id),real_names:p.value.map(e=>e.real_name),student_numbers:p.value.map(e=>e.student_number),article_title:o.article_title,article_type:o.article_type,fee_amount:Number(o.fee_amount),statistical_month:o.statistical_month,department_id:Number(o.department_id)};try{const e=await St(s);e.res_code==="0000"?(a.success("添加稿费记录成功"),Object.keys(o).forEach(l=>{o[l]=""}),p.value=[],m.value="query",M()):a.error(`添加失败：${e.res_msg}`)}catch(e){a.error("网络异常，添加失败"),console.error("添加稿费失败详情：",e)}};lt(()=>{m.value==="query"&&M()});const m=u("query"),U=u([]),pt=u(0),j=V({page:1,size:100,status:""}),K=u(!1),g=u(""),D=V({reply_content:""}),Q=u(!1),L=V({status:"pending"}),W=X(()=>{let s=[...U.value];if(_.value&&(s=s.filter(v=>v.created_at?.split("-")[1]===_.value.padStart(2,"0"))),h.value){const v=h.value.trim().toLowerCase();s=s.filter(O=>O.real_name?.toLowerCase().includes(v))}const e=(y.value-1)*A.value,l=e+A.value;return s.slice(e,l)}),J=X(()=>{let s=[...U.value];if(_.value&&(s=s.filter(e=>e.created_at?.split("-")[1]===_.value.padStart(2,"0"))),h.value){const e=h.value.trim().toLowerCase();s=s.filter(l=>l.real_name?.toLowerCase().includes(e))}return Math.ceil(s.length/A.value)||1}),E=async()=>{try{const s=await Vt(j);s.res_code==="0000"?(U.value=s.data.list||[],pt.value=s.data.total||0,y.value=1):(a.error(`查询失败：${s.res_msg}`),U.value=[])}catch{a.error("网络异常，查询反馈失败"),U.value=[]}},mt=()=>{y.value=1},Z=s=>{s<1||s>J.value||(y.value=s)},bt=s=>{g.value=s,D.reply_content="",K.value=!0},tt=()=>{K.value=!1,g.value="",D.reply_content=""},ft=async()=>{if(!D.reply_content.trim()){a.warning("请输入回复内容");return}try{const s=await $t(g.value,{reply_content:D.reply_content});s.res_code==="0000"?(a.success("回复成功"),tt(),await nt(g.value,{status:"replied"}),await E()):a.error(`回复失败：${s.res_msg}`)}catch{a.error("网络异常，回复失败")}},_t=s=>{g.value=s;const e=U.value.find(l=>l.feedback_id===s);e&&(L.status=e.status||"pending"),Q.value=!0},et=()=>{Q.value=!1,g.value="",L.status="pending"},yt=async()=>{try{const s=await nt(g.value,{status:L.status});s.res_code==="0000"?(a.success("状态更新成功"),et(),await E()):a.error(`状态更新失败：${s.res_msg}`)}catch{a.error("网络异常，状态更新失败")}};return lt(()=>{console.log("进入新闻部，组件挂载，开始初始化数据"),m.value==="feedback"&&E()}),(s,e)=>(i(),kt(Dt,null,{"card-content":Ct(()=>[t("div",It,[t("button",{class:I(["tab-btn",{active:m.value==="query"}]),onClick:e[0]||(e[0]=l=>m.value="query")}," 任务查询 ",2),t("button",{class:I(["tab-btn",{active:m.value==="manage"}]),onClick:e[1]||(e[1]=l=>m.value="manage")}," 任务管理 ",2),t("button",{class:I(["tab-btn",{active:m.value==="feedback"}]),onClick:e[2]||(e[2]=()=>{m.value="feedback",E()})}," 查看反馈 ",2)]),m.value==="query"?(i(),r("div",Bt,[t("div",qt,[e[28]||(e[28]=t("label",null,"选择月份:",-1)),d(t("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=l=>_.value=l)},[...e[27]||(e[27]=[t("option",{value:""},"全部",-1),t("option",{value:"01"},"1月",-1),t("option",{value:"02"},"2月",-1),t("option",{value:"03"},"3月",-1),t("option",{value:"04"},"4月",-1),t("option",{value:"05"},"5月",-1),t("option",{value:"06"},"6月",-1),t("option",{value:"07"},"7月",-1),t("option",{value:"08"},"8月",-1),t("option",{value:"09"},"9月",-1),t("option",{value:"10"},"10月",-1),t("option",{value:"11"},"11月",-1),t("option",{value:"12"},"12月",-1)])],512),[[F,_.value]]),e[29]||(e[29]=t("label",null,"任务名称:",-1)),d(t("input",{type:"text",placeholder:"输入任务名称查询",class:"form-input","onUpdate:modelValue":e[4]||(e[4]=l=>x.value=l)},null,512),[[f,x.value]]),t("button",{class:"query-btn",onClick:H},"查询")]),t("table",Tt,[e[31]||(e[31]=t("thead",null,[t("tr",null,[t("th",null,"任务名称"),t("th",null,"参与人"),t("th",null,"学号"),t("th",null,"稿费金额"),t("th",null,"统计月份"),t("th",null,"操作")])],-1)),t("tbody",null,[w.value.length===0?(i(),r("tr",At,[...e[30]||(e[30]=[t("td",{colspan:"9",class:"empty-tip"},"暂无稿费记录",-1)])])):b("",!0),(i(!0),r(B,null,q(R.value,l=>(i(),r("tr",{key:l.record_id},[t("td",null,n(l.article_title),1),t("td",null,n(l.real_names?.join(", ")||"-"),1),t("td",null,n(l.student_numbers?.join(", ")||"-"),1),t("td",null,n(l.fee_amount),1),t("td",null,n(l.statistical_month),1),t("td",null,[t("button",{class:"op-btn",onClick:v=>ot(l)},"修改",8,Pt),t("button",{class:"op-btn",onClick:v=>rt(l.record_id)},"删除",8,Nt)])]))),128))])]),w.value.length>0?(i(),r("div",zt,[t("button",{class:"page-btn",onClick:e[5]||(e[5]=l=>Y(k.page-1)),disabled:k.page<=1}," 上一页 ",8,jt),t("span",null,"第"+n(k.page)+"页 / 共"+n(P.value)+"页",1),t("button",{class:"page-btn",onClick:e[6]||(e[6]=l=>Y(k.page+1)),disabled:k.page>=P.value}," 下一页 ",8,Kt)])):b("",!0)])):b("",!0),S.value?(i(),r("div",Qt,[t("div",Wt,[t("h4",null,"修改稿费记录（ID: "+n(N.value.record_id)+"）",1),t("div",Jt,[e[32]||(e[32]=t("label",null,"稿件标题:",-1)),d(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[7]||(e[7]=l=>c.article_title=l)},null,512),[[f,c.article_title]])]),t("div",Ot,[e[33]||(e[33]=t("label",null,"稿件类型:",-1)),d(t("input",{type:"text",class:"form-input","onUpdate:modelValue":e[8]||(e[8]=l=>c.article_type=l)},null,512),[[f,c.article_type]])]),t("div",Xt,[e[34]||(e[34]=t("label",null,"稿费金额:",-1)),d(t("input",{type:"number",step:"1",class:"form-input","onUpdate:modelValue":e[9]||(e[9]=l=>c.fee_amount=l)},null,512),[[f,c.fee_amount]])]),t("div",Gt,[e[35]||(e[35]=t("label",null,"统计月份:",-1)),d(t("input",{type:"month",class:"form-input","onUpdate:modelValue":e[10]||(e[10]=l=>c.statistical_month=l)},null,512),[[f,c.statistical_month]])]),t("div",Ht,[e[36]||(e[36]=t("label",null,"备注:",-1)),d(t("textarea",{class:"form-textarea","onUpdate:modelValue":e[11]||(e[11]=l=>c.description=l)},null,512),[[f,c.description]])]),t("div",Yt,[t("button",{class:"cancel-btn",onClick:e[12]||(e[12]=l=>S.value=!1)},"取消"),t("button",{class:"feedback-confirm-btn",onClick:it},"确认修改")])])])):b("",!0),m.value==="manage"?(i(),r("div",Zt,[e[47]||(e[47]=t("div",{class:"manage-title"},[t("div",{class:"title-line"}),t("h3",null,"添加稿费记录")],-1)),t("div",te,[t("div",{class:"form-item"},[t("button",{class:"select-member-btn",onClick:ut},"选择成员")]),p.value.length>0?(i(),r("div",ee,[e[37]||(e[37]=t("h4",null,"已选成员：",-1)),(i(!0),r(B,null,q(p.value,(l,v)=>(i(),r("div",{class:"member-item",key:l.user_id},[t("span",null,"成员"+n(v+1)+"：姓名="+n(l.real_name)+"，学号="+n(l.student_number)+"，ID="+n(l.user_id),1),t("button",{class:"del-member-btn",onClick:O=>ct(v)},"删除",8,le)]))),128))])):b("",!0),t("div",se,[e[38]||(e[38]=t("label",null,"稿件标题:",-1)),d(t("input",{type:"text",placeholder:"输入稿件标题",class:"form-input","onUpdate:modelValue":e[13]||(e[13]=l=>o.article_title=l)},null,512),[[f,o.article_title]])]),t("div",ae,[e[41]||(e[41]=t("label",null,"稿件类型:",-1)),t("div",ne,[t("label",oe,[d(t("input",{type:"radio",name:"article_type","onUpdate:modelValue":e[14]||(e[14]=l=>o.article_type=l),value:"校对"},null,512),[[st,o.article_type]]),e[39]||(e[39]=C(" 校对 ",-1))]),t("label",ie,[d(t("input",{type:"radio",name:"article_type","onUpdate:modelValue":e[15]||(e[15]=l=>o.article_type=l),value:"编辑"},null,512),[[st,o.article_type]]),e[40]||(e[40]=C(" 编辑 ",-1))])])]),t("div",re,[e[42]||(e[42]=t("label",null,"稿费金额:",-1)),d(t("input",{type:"number",step:"0.01",min:"0",placeholder:"0.00",class:"form-input","onUpdate:modelValue":e[16]||(e[16]=l=>o.fee_amount=l)},null,512),[[f,o.fee_amount]])]),t("div",ue,[e[43]||(e[43]=t("label",null,"统计月份:",-1)),d(t("input",{type:"month",class:"form-input","onUpdate:modelValue":e[17]||(e[17]=l=>o.statistical_month=l),min:"2026-01"},null,512),[[f,o.statistical_month]])]),t("div",de,[e[45]||(e[45]=t("label",null,"所属部门:",-1)),d(t("select",{class:"form-select","onUpdate:modelValue":e[18]||(e[18]=l=>o.department_id=l)},[...e[44]||(e[44]=[t("option",{value:""},"请选择部门",-1),t("option",{value:"1"},"新闻部",-1),t("option",{value:"2"},"编辑部",-1),t("option",{value:"3"},"运营部",-1)])],512),[[F,o.department_id]])]),t("button",{class:"submit-btn",onClick:vt,disabled:p.value.length===0},"提交添加",8,ce)]),T.value?(i(),r("div",{key:0,class:"modal-mask",onClick:z},[t("div",{class:"modal-content",onClick:e[19]||(e[19]=wt(()=>{},["stop"]))},[t("div",{class:"modal-header"},[e[46]||(e[46]=t("h3",null,"选择成员",-1)),t("button",{class:"close-modal",onClick:z},"×")]),t("div",ve,[$.value.length>0?(i(),r("div",pe,[(i(!0),r(B,null,q($.value,l=>(i(),r("div",{class:"user-item",key:l.user_id},[t("div",me,[t("span",null,"姓名："+n(l.real_name),1),t("span",null,"学号："+n(l.student_number),1),t("span",null,"ID："+n(l.user_id),1)]),t("button",{class:"select-user-btn",onClick:v=>dt(l),disabled:p.value.some(v=>v.user_id===l.user_id)},n(p.value.some(v=>v.user_id===l.user_id)?"已选择":"选择"),9,be)]))),128))])):(i(),r("div",fe,"暂无用户数据"))]),t("div",{class:"modal-footer"},[t("button",{class:"user-modal-confirm-btn",onClick:z},"确认选择")])])])):b("",!0)])):b("",!0),m.value==="feedback"?(i(),r("div",_e,[t("div",ye,[e[50]||(e[50]=t("label",null,"反馈状态:",-1)),d(t("select",{class:"form-select","onUpdate:modelValue":e[20]||(e[20]=l=>j.status=l)},[...e[48]||(e[48]=[t("option",{value:""},"全部",-1),t("option",{value:"pending"},"待处理",-1),t("option",{value:"replied"},"已回复",-1)])],512),[[F,j.status]]),e[51]||(e[51]=t("label",null,"月份:",-1)),d(t("select",{class:"form-select","onUpdate:modelValue":e[21]||(e[21]=l=>_.value=l)},[...e[49]||(e[49]=[t("option",{value:""},"全部",-1),t("option",{value:"1"},"1月",-1),t("option",{value:"2"},"2月",-1),t("option",{value:"3"},"3月",-1),t("option",{value:"4"},"4月",-1),t("option",{value:"5"},"5月",-1),t("option",{value:"6"},"6月",-1),t("option",{value:"7"},"7月",-1),t("option",{value:"8"},"8月",-1),t("option",{value:"9"},"9月",-1),t("option",{value:"10"},"10月",-1),t("option",{value:"11"},"11月",-1),t("option",{value:"12"},"12月",-1)])],512),[[F,_.value]]),e[52]||(e[52]=t("label",null,"用户姓名:",-1)),d(t("input",{type:"text",placeholder:"输入姓名模糊查询",class:"form-input","onUpdate:modelValue":e[22]||(e[22]=l=>h.value=l)},null,512),[[f,h.value]]),t("button",{class:"query-btn",onClick:mt},"查询")]),t("div",ge,[W.value.length===0?(i(),r("div",ke,"暂无反馈数据")):b("",!0),(i(!0),r(B,null,q(W.value,l=>(i(),r("div",{class:"feedback-item",key:l.feedback_id},[t("div",Ce,[t("span",we,"反馈ID："+n(l.feedback_id),1),t("span",{class:I(["status-tag",at(Mt)[l.status]])},n(at(Lt)[l.status]),3)]),t("div",he,[t("p",null,[e[53]||(e[53]=t("span",{class:"label"},"反馈用户：",-1)),C(n(l.real_name),1)]),t("p",null,[e[54]||(e[54]=t("span",{class:"label"},"反馈内容：",-1)),C(n(l.content),1)]),t("p",null,[e[55]||(e[55]=t("span",{class:"label"},"反馈时间：",-1)),C(n(l.created_at),1)]),t("p",null,[e[56]||(e[56]=t("span",{class:"label"},"回复时间：",-1)),C(n(l.replied_at||"未回复"),1)]),t("p",null,[e[57]||(e[57]=t("span",{class:"label"},"回复内容：",-1)),C(n(l.reply_content||"暂无回复"),1)])]),t("div",Ue,[t("button",{class:"op-btn reply-btn",onClick:v=>bt(l.feedback_id)},"回复",8,De),t("button",{class:"op-btn status-btn",onClick:v=>_t(l.feedback_id)},"改状态",8,Ve)])]))),128))]),W.value.length>0?(i(),r("div",$e,[t("button",{class:"page-btn",onClick:e[23]||(e[23]=l=>Z(y.value-1)),disabled:y.value<=1}," 上一页 ",8,Me),t("span",null,"第"+n(y.value)+"页 / 共"+n(J.value)+"页",1),t("button",{class:"page-btn",onClick:e[24]||(e[24]=l=>Z(y.value+1)),disabled:y.value>=J.value}," 下一页 ",8,Le)])):b("",!0),K.value?(i(),r("div",Fe,[t("div",Re,[t("h4",null,"回复反馈（ID: "+n(g.value)+"）",1),d(t("textarea",{placeholder:"请输入回复内容",class:"reply-textarea","onUpdate:modelValue":e[25]||(e[25]=l=>D.reply_content=l)},null,512),[[f,D.reply_content]]),t("div",{class:"dialog-btns"},[t("button",{class:"cancel-btn",onClick:tt},"取消"),t("button",{class:"feedback-confirm-btn",onClick:ft},"提交回复")])])])):b("",!0),Q.value?(i(),r("div",xe,[t("div",Se,[t("h4",null,"更新反馈状态（ID: "+n(g.value)+"）",1),d(t("select",{class:"form-select","onUpdate:modelValue":e[26]||(e[26]=l=>L.status=l)},[...e[58]||(e[58]=[t("option",{value:"pending"},"待处理",-1),t("option",{value:"replied"},"已回复",-1)])],512),[[F,L.status]]),t("div",{class:"dialog-btns"},[t("button",{class:"cancel-btn",onClick:et},"取消"),t("button",{class:"feedback-confirm-btn",onClick:yt},"确认更新")])])])):b("",!0)])):b("",!0)]),_:1}))}},ze=gt(Ee,[["__scopeId","data-v-77360e38"]]);export{ze as default};

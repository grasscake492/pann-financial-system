import{hi as v,hj as g,r as _,f,hB as y,g3 as d,hn as k,ho as o,hp as u,hx as x,hq as a,hs as c,ht as A,hJ as b,hK as E,hv as r,hy as B}from"./index-CAl9Fkbs.js";import{g as N,N as w}from"./Navbar-kC0yHLwy.js";import{A as C}from"./AnnounceBackground-DskhKwol.js";import{g as D}from"./announcement-BPkJOlzB.js";const V={class:"announcement-container"},I={class:"announcement-list"},L={key:0,class:"empty-tip"},M={key:1,class:"empty-tip"},T=["onClick"],j={class:"announcement-date"},q={class:"announcement-content"},z={key:0,class:"content-title"},F={key:1,class:"content-expanded"},J={class:"content-title"},K={class:"content-body"},R={class:"content-footer"},$={__name:"Announcement",setup(G){const p=g(),s=_([]),i=_(!0);console.log("普通用户");const h=e=>e?e.split(" ")[0]||e:"未知时间";f(async()=>{try{if(!y()){d.warning("请先登录"),await p.push("/login");return}i.value=!0;const n=await D({page:1,size:20,order_by:"published_at",sort:"desc",sign:N({timestamp:Date.now()})});if(i.value=!1,n.res_code==="0000"){const t=n.data?.list||[];Array.isArray(t)&&(s.value=t.map(l=>({...l,isExpanded:!1})))}else d.error(n.res_msg||"获取公告失败")}catch(e){i.value=!1,console.error("请求公告失败（网络错误）：",e),s.value=[],d.error("获取公告失败，请稍后重试")}console.log("最终渲染的公告列表：",s.value)});const m=e=>{const n=s.value[e];s.value[e]={...n,isExpanded:!n.isExpanded}};return(e,n)=>(o(),k(C,null,{"page-title":u(()=>[...n[0]||(n[0]=[B("所有公告",-1)])]),"card-content":u(()=>[a("div",V,[a("div",I,[i.value?(o(),c("div",L,"加载中...")):s.value.length===0?(o(),c("div",M," 暂无公告 ")):A("",!0),(o(!0),c(b,null,E(s.value,(t,l)=>(o(),c("div",{class:"announcement-item",key:t.announcement_id,onClick:H=>m(l)},[a("div",j,"["+r(h(t.published_at))+"]",1),a("div",q,[t.isExpanded?(o(),c("div",F,[a("div",J,r(t.title),1),a("div",K,r(t.content),1),a("div",R,"发布人ID："+r(t.publisher_id),1)])):(o(),c("div",z,r(t.title),1))])],8,T))),128))])])]),default:u(()=>[x(w,{style:{"background-color":"transparent!important"}})]),_:1}))}},U=v($,[["__scopeId","data-v-f10ae72f"]]);export{U as default};

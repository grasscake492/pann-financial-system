import{hY as a}from"./index-DmjI61J4.js";import{g as r}from"./Navbar-h4UJXtjf.js";import{d as i,u,p as l,a as m,g as d}from"./announcement-B3tAbs6W.js";import{s as h}from"./feedback-CqbHsbEQ.js";const A=a("notice",{state:()=>({announcementList:[],currentAnnouncement:{},announcementTotal:0,announcementCurrentPage:1,feedbackList:[],pendingFeedbackList:[],currentFeedback:{},feedbackTotal:0,feedbackCurrentPage:1}),getters:{latestThreeAnnouncements:e=>e.announcementList.filter(t=>t.published_at).slice(0,3)},actions:{async fetchAllAnnouncements(e={}){try{const t={page:1,size:10,order_by:"published_at",sort:"desc",...e},n=r({timestamp:Date.now()}),s=await d({...t,sign:n});s.res_code==="0000"?(this.announcementList=s.data.list||[],this.announcementTotal=s.data.total||0):console.error("获取公告失败：",s.res_msg)}catch(t){console.error("请求公告异常：",t)}},async fetchAnnouncementDetail(e){try{const t=r({timestamp:Date.now()}),n=await m(e,{sign:t});n.res_code==="0000"?this.currentAnnouncement=n.data.announcementInfo||{}:console.error("获取公告详情失败：",n.res_msg)}catch(t){console.error("获取公告详情异常：",t)}},async publishAnnouncement(e){try{const t=r({timestamp:Date.now(),...e}),n=await l({...e,sign:t});return n.res_code==="0000"?!0:(console.error("发布公告失败：",n.res_msg),!1)}catch(t){return console.error("发布公告异常：",t),!1}},async updateAnnouncement(e,t){try{const n=r({timestamp:Date.now(),...t}),s=await u(e,{...t,sign:n});return s.res_code==="0000"?(await this.fetchAnnouncementDetail(e),!0):(console.error("修改公告失败：",s.res_msg),!1)}catch(n){return console.error("修改公告异常：",n),!1}},async deleteAnnouncement(e,t){try{const n=r({timestamp:Date.now()}),s=await i(e,{sign:n});if(s.res_code==="0000"){const o=t.filter(c=>c!==e);return await this.fetchAllAnnouncements({announcementIds:o}),!0}else return console.error("删除公告失败：",s.res_msg),!1}catch(n){return console.error("删除公告异常：",n),!1}},setAnnouncements(e){this.announcements=e.list||e.records||e,this.total=e.total||e.length},setAnnouncementList(e){this.announcementList=e},setCurrentAnnouncement(e){this.currentAnnouncement=e},setAnnouncementCurrentPage(e){this.announcementCurrentPage=e},clearAnnouncement(){this.announcementList=[],this.announcementTotal=0},setFeedbackList(e){this.feedbackList=e||[]},setPendingFeedbackList(e){this.pendingFeedbackList=e||[]},setCurrentFeedback(e){this.currentFeedback=e||{}},addFeedback(e){e&&this.feedbackList.unshift(e)},replyFeedback(){},updateFeedbackStatus(){},setFeedbackCurrentPage(e){this.feedbackCurrentPage=e||1},async submitUserFeedback(e){try{if(!e.user_id||!e.content)return console.error("提交反馈失败：缺少用户ID或反馈内容"),!1;const t=r({timestamp:Date.now(),...e}),n=await h({...e,sign:t});if(n.res_code==="0000"){const s={...n.data,...e,create_time:new Date().toString()};return this.feedbackList.unshift(s),this.feedbackTotal=this.feedbackList.length,!0}else return console.error("提交反馈失败：",n.res_msg),!1}catch(t){return console.error("提交反馈异常：",t),!1}},clearNoticeInfo(){this.announcementList=[],this.currentAnnouncement={},this.announcementTotal=0,this.feedbackList=[],this.currentFeedback={},this.feedbackTotal=0}}});export{A as u};

import{hi as H,hj as O,hz as W,r as i,hl as X,hI as Z,f as ee,hm as h,hn as te,ho as p,hp as r,hq as t,hx as _,hr as C,hS as L,hu as z,hs as g,ht as I,hJ as B,hK as R,hv as n,b as P,hy as N,hT as j,g3 as c}from"./index-DmjI61J4.js";import{P as ae}from"./PageBackground2-DIHdH8cQ.js";import{g as se}from"./royalty-Nces9iCc.js";import{g as le,s as ne}from"./feedback-CqbHsbEQ.js";import{f as oe,a as E,b as re}from"./Navbar-h4UJXtjf.js";import{u as ue}from"./notice-Bxpf-dwb.js";import"./announcement-B3tAbs6W.js";const de={class:"tab-container"},ie={class:"tab-header"},ce={class:"tab-content"},pe={class:"query-area"},fe={class:"fee-table"},me={key:0},ve=["onClick"],be={class:"total-area"},_e={class:"total-amount"},ge={class:"pagination-area"},ke=["disabled"],ye={class:"page-info"},De=["disabled"],he={class:"tab-content"},Ce={class:"feedback-table"},we={key:0},Ve={class:"content-cell"},xe={class:"reply-cell"},Ne={__name:"RoyaltyDetail",setup($e){O();const $=W();ue();const f=i("fee"),m=i([]),v=i(!1),A=i({}),u=i({content:"",feedback_id:""}),a=X({startDate:"2026-01-01",endDate:"",taskName:"",page:1,size:10}),k=i([]),w=i(0),V=i(0),M=Z(()=>Math.ceil(w.value/a.size)),T=()=>{const s=new Date,e=s.getFullYear(),y=String(s.getMonth()+1).padStart(2,"0"),D=String(s.getDate()).padStart(2,"0");return`${e}-${y}-${D}`},S=s=>s?re(s).split(" ")[0]:"",x=async()=>{if(a.startDate&&a.endDate&&new Date(a.endDate)<new Date(a.startDate)){c.error("结束日期不能早于开始日期，请重新选择");return}try{const s={startDate:a.startDate,endDate:a.endDate,page:a.page,size:a.size},e=await se(s);if(e.res_code==="0000"){const{total:y,list:D}=e.data;w.value=y;let b=D.filter(o=>{const d=o.created_at?o.created_at.split(" ")[0]:"";return!a.startDate&&!a.endDate?!0:a.startDate&&!a.endDate?d>=a.startDate:(!a.startDate&&a.endDate||d>=a.startDate)&&d<=a.endDate});a.taskName&&(b=b.filter(o=>o.article_title?.toLowerCase().includes(a.taskName.toLowerCase()))),k.value=b,V.value=b.reduce((o,d)=>o+(Number(d.fee_amount)||0),0)}else alert(`查询失败：${e.res_msg}`),k.value=[],w.value=0,V.value=0}catch(s){console.error("查询稿费明细失败：",s),alert("网络异常，查询失败"),k.value=[],w.value=0,V.value=0}},J=()=>{a.startDate="2026-01-01",a.endDate=T(),a.taskName="",a.page=1,x()},U=s=>{s<1||s>M.value||(a.page=s,x())},K=s=>{A.value=s,u.value={content:"",feedback_id:s.feedback_id},v.value=!0},Q=async()=>{if(!u.value.content.trim()){c.error("请填写反馈理由");return}if(!$.userInfo?.user_id){c.error("请先登录"),v.value=!1;return}const s={user_id:$.userInfo.user_id,content:u.value.content,feedback_id:u.value.feedback_id};try{const e=await ne(s);e.res_code==="0000"?(c.success("反馈提交成功！"),v.value=!1,u.value.content="",q()):c.error(`提交失败：${e.data?.res_msg||"未知错误"}`)}catch(e){c.error("网络异常，提交失败"),console.error("反馈提交失败:",e)}},Y=s=>({pending:"待处理",replied:"已回复",resolved:"已解决",rejected:"已驳回"})[s]||"未知状态",G=s=>({pending:"status-pending",replied:"status-replied",resolved:"status-resolved",rejected:"status-rejected"})[s]||"",q=async()=>{if($.userInfo?.user_id)try{const s=await le({page:1,size:10});s.res_code==="0000"?m.value=s.data.list||[]:(c.error(`获取反馈列表失败：${s.res_msg}`),m.value=[])}catch(s){c.error("网络异常，获取反馈列表失败"),console.error("获取反馈列表失败:",s),m.value=[]}};return ee(()=>{a.endDate=T(),x(),q()}),(s,e)=>{const y=h("el-input"),D=h("el-form-item"),b=h("el-form"),o=h("el-button"),d=h("el-dialog");return p(),te(ae,null,{"page-title":r(()=>[...e[10]||(e[10]=[N("我的稿费与反馈",-1)])]),"card-content":r(()=>[t("div",de,[t("div",ie,[t("div",{class:L(["tab-item",{active:f.value==="fee"}]),onClick:e[0]||(e[0]=l=>f.value="fee")}," 我的稿费明细 ",2),t("div",{class:L(["tab-item",{active:f.value==="feedback"}]),onClick:e[1]||(e[1]=l=>f.value="feedback")}," 我的反馈记录 ",2)]),C(t("div",ce,[t("div",pe,[e[11]||(e[11]=t("label",null,"开始日期:",-1)),C(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=l=>a.startDate=l),class:"date-input"},null,512),[[z,a.startDate]]),e[12]||(e[12]=t("label",{class:"ml-20"},"结束日期:",-1)),C(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=l=>a.endDate=l),class:"date-input"},null,512),[[z,a.endDate]]),e[13]||(e[13]=t("label",{class:"ml-20"},"任务名称:",-1)),C(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=l=>a.taskName=l),placeholder:"输入任务名称查询",class:"task-input"},null,512),[[z,a.taskName]]),t("button",{class:"query-btn",onClick:x},"查询"),t("button",{class:"reset-btn ml-20",onClick:J},"重置")]),t("table",fe,[e[16]||(e[16]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"任务名称"),t("th",null,"部门"),t("th",null,"金额"),t("th",null,"操作")])],-1)),t("tbody",null,[k.value.length===0?(p(),g("tr",me,[...e[14]||(e[14]=[t("td",{colspan:"6",class:"empty-tip"},"暂无稿费数据",-1)])])):I("",!0),(p(!0),g(B,null,R(k.value,(l,F)=>(p(),g("tr",{key:l.feedback_id||F},[t("td",null,n(S(l.created_at)||"-"),1),t("td",null,n(l.article_title||"-"),1),t("td",null,n(P(oe)(l.department_id)),1),t("td",null,n(P(E)(l.fee_amount))+"元",1),t("td",null,[t("button",{class:"feedback-btn",onClick:Me=>K(l)},"反馈",8,ve)])]))),128))]),t("template",be,[e[15]||(e[15]=N(" 共计: ",-1)),t("span",_e,n(P(E)(V.value))+"元",1)])]),t("div",ge,[t("button",{class:"page-btn",onClick:e[5]||(e[5]=l=>U(a.page-1)),disabled:a.page<=1},"上一页",8,ke),t("span",ye," 第"+n(a.page)+"页 / 共"+n(M.value)+"页 ",1),t("button",{class:"page-btn",onClick:e[6]||(e[6]=l=>U(a.page+1)),disabled:a.page>=M.value},"下一页",8,De)])],512),[[j,f.value==="fee"]]),C(t("div",he,[t("table",Ce,[e[18]||(e[18]=t("thead",null,[t("tr",null,[t("th",null,"稿费名称"),t("th",null,"反馈内容"),t("th",null,"提交时间"),t("th",null,"反馈状态"),t("th",null,"管理员回复"),t("th",null,"回复时间")])],-1)),t("tbody",null,[!m.value||m.value.length===0?(p(),g("tr",we,[...e[17]||(e[17]=[t("td",{colspan:"6",class:"empty-tip"},"暂无反馈记录",-1)])])):I("",!0),(p(!0),g(B,null,R(m.value,(l,F)=>(p(),g("tr",{key:l.feedback_id||F},[t("td",null,n(l.feedback_id||"-"),1),t("td",Ve,n(l.content||"-"),1),t("td",null,n(S(l.created_at)||"-"),1),t("td",null,[t("span",{class:L(["status-tag",G(l.status)])},n(Y(l.status)),3)]),t("td",xe,n(l.reply_content||"暂无回复"),1),t("td",null,n(S(l.replied_at)||"-"),1)]))),128))])])],512),[[j,f.value==="feedback"]])]),_(d,{modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=l=>v.value=l),title:"提交稿费反馈",width:"400px",modal:!1,class:"no-shadow-dialog"},{footer:r(()=>[_(o,{onClick:e[8]||(e[8]=l=>v.value=!1)},{default:r(()=>[...e[19]||(e[19]=[N("取消",-1)])]),_:1}),_(o,{type:"primary",onClick:Q},{default:r(()=>[...e[20]||(e[20]=[N("提交",-1)])]),_:1})]),default:r(()=>[_(b,{model:u.value,"label-width":"80px"},{default:r(()=>[_(D,{label:"反馈理由",required:""},{default:r(()=>[_(y,{modelValue:u.value.content,"onUpdate:modelValue":e[7]||(e[7]=l=>u.value.content=l),type:"textarea",rows:4,placeholder:"请输入您的反馈问题（如稿费金额错误、漏算等）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),default:r(()=>[e[21]||(e[21]=t("div",{class:"title-line"},null,-1))]),_:1})}}},qe=H(Ne,[["__scopeId","data-v-c6a443a6"]]);export{qe as default};

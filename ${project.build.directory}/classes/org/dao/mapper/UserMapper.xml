<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.dao.UserMapper">

    <!-- 用户表结果映射 -->
    <resultMap id="UserResultMap" type="org.entity.User">
        <id property="userId" column="user_id" />
        <result property="studentNumber" column="student_number" />
        <result property="realName" column="real_name" />
        <result property="password" column="password" />
        <result property="email" column="email" />
    </resultMap>

    <!-- 根据用户ID查询用户 -->
    <select id="selectByUserId" parameterType="java.lang.Long" resultMap="UserResultMap">
        SELECT user_id, student_number, real_name, password, email
        FROM users
        WHERE user_id = #{userId}
    </select>

    <!-- 根据学号查询用户 -->
    <select id="selectByStudentNumber" parameterType="java.lang.String" resultMap="UserResultMap">
        SELECT user_id, student_number, real_name, password, email
        FROM users
        WHERE student_number = #{studentNumber}
    </select>

    <!-- 根据邮箱查询用户 -->
    <select id="selectByEmail" parameterType="java.lang.String" resultMap="UserResultMap">
        SELECT user_id, student_number, real_name, password, email
        FROM users
        WHERE email = #{email}
    </select>

    <!-- 根据真实姓名查询用户 -->
    <select id="selectByUserName" parameterType="java.lang.String" resultMap="UserResultMap">
        SELECT user_id, student_number, real_name, password, email
        FROM users
        WHERE real_name = #{realName}
        ORDER BY user_id
    </select>

    <!-- 查询所有用户 -->
    <select id="selectAllUsers" resultMap="UserResultMap">
        SELECT user_id, student_number, real_name, password, email
        FROM users
        ORDER BY user_id
    </select>

    <!-- 分页查询用户 -->
    <select id="selectUsersByPage" resultMap="UserResultMap">
        SELECT user_id, student_number, real_name, password, email
        FROM users
        ORDER BY user_id
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 统计用户总数 -->
    <select id="countUsers" resultType="int">
        SELECT COUNT(*) FROM users
    </select>

    <!-- 插入新用户 -->
    <insert id="insertUser" parameterType="org.entity.User" useGeneratedKeys="true" keyProperty="userId">
        INSERT INTO users (student_number, real_name, password, email)
        VALUES (#{studentNumber}, #{realName}, #{password}, #{email}, NOW(), NOW())
    </insert>

    <!-- 更新用户信息 -->
    <update id="updateUser" parameterType="org.entity.User">
        UPDATE users
        SET student_number = #{studentNumber},
            real_name = #{realName},
            email = #{email}
        WHERE user_id = #{userId}
    </update>

    <!-- 更新用户密码 -->
    <update id="updatePassword">
        UPDATE users
        SET password = #{newPassword}
        WHERE user_id = #{userId}
    </update>

    <!-- 根据用户ID删除用户 -->
    <delete id="deleteByUserId" parameterType="java.lang.Long">
        DELETE FROM users
        WHERE user_id = #{userId}
    </delete>

    <!-- 根据关键词搜索用户（学号或姓名） -->
    <select id="searchUsers" parameterType="java.lang.String" resultMap="UserResultMap">
        SELECT user_id, student_number, real_name, password, email
        FROM users
        WHERE student_number LIKE CONCAT('%', #{keyword}, '%')
           OR real_name LIKE CONCAT('%', #{keyword}, '%')
        ORDER BY user_id
    </select>

</mapper>